{"ast":null,"code":"var _jsxFileName = \"/Users/keith/progs/React/ncei-normals-mapper/src/components/GetResults.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useContext } from \"react\";\nimport CircularProgress from \"@mui/material/CircularProgress\";\nimport InputParamsContext from './InputParamsContext';\nimport { buildParams } from '../utilities/utils';\nimport DisplayMap from \"./DisplayMap\";\nimport DisplayJson from \"./DisplayJson\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst GetResults = props => {\n  _s();\n  const {\n    inputParams,\n    updateLevels\n  } = props;\n  const [mapBlob, setMapBlob] = useState();\n  const [jsonresp, setJsonresp] = useState();\n  const [imgInfo, setImgInfo] = useState();\n  const [resultsError, setResultsError] = useState();\n  const [loading, setLoading] = useState(false);\n  const [submittedParams, setSubmittedParams] = useState();\n  const inputContext = useContext(InputParamsContext);\n  const fetchResponse = (params, output) => {\n    const infoInput = JSON.stringify({\n      ...params,\n      output: \"json\"\n    });\n    fetch(\"https://grid2.rcc-acis.org/GridData\", {\n      body: infoInput,\n      method: \"POST\",\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).then(response => {\n      if (!response.ok) {\n        const message = \"Error on request\" + (response.statusText ? \": \" + response.statusText : \"\");\n        setResultsError(message);\n        return response.json(); // return to possibly get better message from json\n      }\n\n      return response.json();\n    }).then(response => {\n      if (response.error) {\n        //setResultsError(response.status + \" \" + response.error)\n        //always getting extraneous call returning status:\"invalid request.\" and error:\"unknown image return type: text/plain\"\n        //suppressing\n        setResultsError(\"\");\n      } else if (output === 'png') {\n        setResultsError(\"\");\n        setMapBlob(response.data);\n        setImgInfo(response);\n      } else {\n        setResultsError(\"\");\n        setJsonresp(response.data);\n      }\n    }).catch(err => {\n      if (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n        setResultsError(\"Invalid grid request - \" + infoInput);\n      } else {\n        setResultsError(\"Error: \" + err.message);\n      }\n      ;\n    }).finally(() => {\n      setLoading(false);\n    });\n  };\n  useEffect(() => {\n    console.log(inputParams);\n    setResultsError(null);\n    setLoading(true);\n    // Build parameters\n    const input = buildParams(inputParams);\n    // Save parameters \n    setSubmittedParams(input);\n    if (input.output === 'png' && input.image.levels) {\n      updateLevels({\n        client: input.image.levels\n      });\n    } else {\n      updateLevels({\n        client: []\n      });\n    }\n    // Get results\n    fetchResponse(input, input.output);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [inputParams]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [loading && /*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 77,\n      columnNumber: 5\n    }, this), submittedParams && (jsonresp || mapBlob) && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [mapBlob && /*#__PURE__*/_jsxDEV(DisplayMap, {\n        imgsrc: mapBlob,\n        imgInfo: imgInfo,\n        submittedParams: submittedParams\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 7\n      }, this), jsonresp && /*#__PURE__*/_jsxDEV(DisplayJson, {\n        jsonresp: jsonresp,\n        submittedParams: submittedParams\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 89,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true), resultsError && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: resultsError\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 97,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true);\n};\n_s(GetResults, \"PrDrsvMWrwAUPEJhi1lWXaD+z3Y=\");\n_c = GetResults;\nexport default GetResults;\nvar _c;\n$RefreshReg$(_c, \"GetResults\");","map":{"version":3,"names":["React","useEffect","useState","useContext","CircularProgress","InputParamsContext","buildParams","DisplayMap","DisplayJson","jsxDEV","_jsxDEV","Fragment","_Fragment","GetResults","props","_s","inputParams","updateLevels","mapBlob","setMapBlob","jsonresp","setJsonresp","imgInfo","setImgInfo","resultsError","setResultsError","loading","setLoading","submittedParams","setSubmittedParams","inputContext","fetchResponse","params","output","infoInput","JSON","stringify","fetch","body","method","headers","then","response","ok","message","statusText","json","error","data","catch","err","includes","finally","console","log","input","image","levels","client","children","fileName","_jsxFileName","lineNumber","columnNumber","imgsrc","_c","$RefreshReg$"],"sources":["/Users/keith/progs/React/ncei-normals-mapper/src/components/GetResults.js"],"sourcesContent":["import React, { useEffect, useState, useContext } from \"react\";\nimport CircularProgress from \"@mui/material/CircularProgress\";\nimport InputParamsContext from './InputParamsContext';\nimport { buildParams } from '../utilities/utils';\nimport DisplayMap from \"./DisplayMap\";\nimport DisplayJson from \"./DisplayJson\";\n\nconst GetResults = (props) => {\n\tconst { inputParams, updateLevels } = props;\n\tconst [mapBlob, setMapBlob] = useState();\n\tconst [jsonresp, setJsonresp] = useState();\n\tconst [imgInfo, setImgInfo] = useState();\n\tconst [resultsError, setResultsError] = useState();\n\tconst [loading, setLoading] = useState(false);\n\tconst [submittedParams, setSubmittedParams] = useState();\n\tconst inputContext = useContext(InputParamsContext);\n\n\tconst fetchResponse = (params, output) => {\n\t\tconst infoInput = JSON.stringify({...params, output: \"json\"});\n\t\tfetch(\"https://grid2.rcc-acis.org/GridData\", {body: infoInput, method: \"POST\", headers: {'Content-Type': 'application/json'},})\n\t\t\t.then(response => {\n\t\t\t\tif (!response.ok) {\n\t\t\t\t\tconst message = \"Error on request\" + (response.statusText ? (\": \" + response.statusText) : \"\");\n\t\t\t\t\tsetResultsError(message);\n\t\t\t\t\treturn response.json();\t// return to possibly get better message from json\n\t\t\t\t}\n\t\t\t\treturn response.json();\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\tif (response.error) {\n\t\t\t\t\t//setResultsError(response.status + \" \" + response.error)\n\t\t\t\t\t//always getting extraneous call returning status:\"invalid request.\" and error:\"unknown image return type: text/plain\"\n\t\t\t\t\t//suppressing\n\t\t\t\t\tsetResultsError(\"\");\n\t\t\t\t} else if (output === 'png') {\n\t\t\t\t\tsetResultsError(\"\");\n\t\t\t\t\tsetMapBlob(response.data);\n\t\t\t\t\tsetImgInfo(response);\n\t\t\t\t} else {\n\t\t\t\t\tsetResultsError(\"\");\n\t\t\t\t\tsetJsonresp(response.data);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tif (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n\t\t\t\t\tsetResultsError(\"Invalid grid request - \"+infoInput);\n\t\t\t\t} else {\n\t\t\t\t\tsetResultsError(\"Error: \" + err.message);\n\t\t\t\t};\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tsetLoading(false);\n\t\t\t});\n\t};\n\n\tuseEffect(() => {\nconsole.log(inputParams)\n\t\tsetResultsError(null);\n\t\tsetLoading(true);\n\t\t// Build parameters\n\t\tconst input = buildParams(inputParams);\n\t\t// Save parameters \n\t\tsetSubmittedParams(input);\n\t\tif (input.output === 'png' && input.image.levels) {\n\t\t\tupdateLevels({client: input.image.levels});\n\t\t} else {\n\t\t\tupdateLevels({client: []});\n\t\t}\n\t\t// Get results\n\t\tfetchResponse(input, input.output);\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [inputParams]);\n\n\treturn (\n\t\t<>\n\t\t\t{loading &&\n\t\t\t\t<CircularProgress />\n\t\t\t}\n\t\t\t{submittedParams && (jsonresp || mapBlob) &&\n\t\t\t\t<>\n\t\t\t\t\t{mapBlob &&\n\t\t\t\t\t\t<DisplayMap \n\t\t\t\t\t\t\timgsrc={mapBlob}\n\t\t\t\t\t\t\timgInfo={imgInfo}\n\t\t\t\t\t\t\tsubmittedParams={submittedParams}\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t\t{jsonresp &&\n\t\t\t\t\t\t<DisplayJson\n\t\t\t\t\t\t\tjsonresp={jsonresp}\n\t\t\t\t\t\t\tsubmittedParams={submittedParams}\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t</>\n\t\t\t}\n\t\t\t{resultsError &&\n\t\t\t\t<p>{resultsError}</p>\n\t\t\t}\n\t\t</>\n\t);\n}\n\nexport default GetResults;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}