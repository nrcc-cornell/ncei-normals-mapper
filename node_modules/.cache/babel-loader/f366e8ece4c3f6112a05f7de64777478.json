{"ast":null,"code":"import _slicedToArray from\"/Users/kle1/progs/React/ncei-normals-mapper/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import React,{useEffect,useState,useContext}from'react';import{MapContainer,TileLayer,Polygon,ImageOverlay}from'react-leaflet';import{makeStyles}from'@material-ui/core/styles';import InputParamsContext from'./InputParamsContext';import{multiStateBbox}from'../utilities/utils';var useStyles=makeStyles(function(theme){return{nav:{position:\"absolute\",top:0,left:0,padding:\"3px\"},mapContainer:{border:\"1pt solid midnightblue\",height:window.innerHeight*0.6}};});var LeafletMap=function LeafletMap(props){var imgsrc=props.imgsrc,submittedParams=props.submittedParams;var _useState=useState(),_useState2=_slicedToArray(_useState,2),bbox=_useState2[0],setBbox=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),imgcoords=_useState4[0],setImgcoords=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),resultsError=_useState6[0],setResultsError=_useState6[1];var inputContext=useContext(InputParamsContext);var classes=useStyles();var fetchBbox=function fetchBbox(postals){var jsonparams=JSON.stringify({state:postals,meta:\"bbox\"});fetch(\"https://data.rcc-acis.org/General/state\",{body:jsonparams,method:\"POST\",headers:{'Content-Type':'application/json'}}).then(function(response){if(!response.ok){setResultsError(\"Error\");}return response.json();}).then(function(response){if(response.meta&&response.meta.length){var _bbox=multiStateBbox(response.meta);setBbox(_bbox);}else{setResultsError(\"No bbox for \"+postals);}}).catch(function(err){if(err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")){setResultsError(\"Invalid request\");}else{setResultsError(err.message);};});};useEffect(function(){if(inputContext.inputParams.areaDef.bbox){var _bbox2=JSON.parse(submittedParams).bbox;setBbox([parseFloat(_bbox2[0]),parseFloat(_bbox2[1]),parseFloat(_bbox2[2]),parseFloat(_bbox2[3])]);}else{var postals=inputContext.inputParams.areaDef.state;fetchBbox(postals);}// eslint-disable-next-line \n},[inputContext.inputParams.areaDef]);useEffect(function(){if(bbox){// convert bbox to Leaflet coordinates\nsetImgcoords([[bbox[3],bbox[0]],[bbox[3],bbox[2]],[bbox[1],bbox[2]],[bbox[1],bbox[0]]]);}// eslint-disable-next-line \n},[bbox]);return/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(\"div\",{className:classes.mapContainer,children:bbox&&/*#__PURE__*/_jsxs(MapContainer,{bounds:[[bbox[1],bbox[0]],[bbox[3],bbox[2]]],zoomControl:true,scrollWheelZoom:true,attributionControl:true,children:[/*#__PURE__*/_jsx(TileLayer,{url:\"https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png\",attribution:\"\\xA9 <a href=\\\"https://www.openstreetmap.org/copyright\\\">OpenStreetMap</a> contributors \\xA9 <a href=\\\"https://carto.com/attributions\\\">CARTO</a>\"}),imgcoords&&/*#__PURE__*/_jsx(Polygon,{pathOptions:{color:\"lightgray\",weight:1,fill:false,opacity:0.8},positions:imgcoords}),imgcoords&&imgsrc&&/*#__PURE__*/_jsx(ImageOverlay,{url:imgsrc,bounds:imgcoords,opacity:0.8,zIndex:10})]})}),resultsError&&/*#__PURE__*/_jsxs(\"p\",{children:[\"Error: \",resultsError]})]});};export default LeafletMap;","map":{"version":3,"sources":["/Users/kle1/progs/React/ncei-normals-mapper/src/components/LeafletMap.js"],"names":["React","useEffect","useState","useContext","MapContainer","TileLayer","Polygon","ImageOverlay","makeStyles","InputParamsContext","multiStateBbox","useStyles","theme","nav","position","top","left","padding","mapContainer","border","height","window","innerHeight","LeafletMap","props","imgsrc","submittedParams","bbox","setBbox","imgcoords","setImgcoords","resultsError","setResultsError","inputContext","classes","fetchBbox","postals","jsonparams","JSON","stringify","state","meta","fetch","body","method","headers","then","response","ok","json","length","catch","err","message","includes","inputParams","areaDef","parse","parseFloat","color","weight","fill","opacity"],"mappings":"+SAAA,MAAOA,CAAAA,KAAP,EAAgBC,SAAhB,CAA2BC,QAA3B,CAAqCC,UAArC,KAAuD,OAAvD,CACA,OAASC,YAAT,CAAuBC,SAAvB,CAAkCC,OAAlC,CAA2CC,YAA3C,KAA+D,eAA/D,CACA,OAASC,UAAT,KAA2B,0BAA3B,CACA,MAAOC,CAAAA,kBAAP,KAA+B,sBAA/B,CACA,OAASC,cAAT,KAA+B,oBAA/B,CAEA,GAAMC,CAAAA,SAAS,CAAGH,UAAU,CAAC,SAACI,KAAD,QAAY,CACxCC,GAAG,CAAE,CACJC,QAAQ,CAAE,UADN,CAEJC,GAAG,CAAE,CAFD,CAGJC,IAAI,CAAE,CAHF,CAIJC,OAAO,CAAE,KAJL,CADmC,CAOxCC,YAAY,CAAE,CACbC,MAAM,CAAE,wBADK,CAEbC,MAAM,CAAEC,MAAM,CAACC,WAAP,CAAqB,GAFhB,CAP0B,CAAZ,EAAD,CAA5B,CAaA,GAAMC,CAAAA,UAAU,CAAG,QAAbA,CAAAA,UAAa,CAACC,KAAD,CAAW,IACrBC,CAAAA,MADqB,CACOD,KADP,CACrBC,MADqB,CACbC,eADa,CACOF,KADP,CACbE,eADa,eAEHxB,QAAQ,EAFL,wCAErByB,IAFqB,eAEfC,OAFe,8BAGO1B,QAAQ,EAHf,yCAGrB2B,SAHqB,eAGVC,YAHU,8BAIa5B,QAAQ,EAJrB,yCAIrB6B,YAJqB,eAIPC,eAJO,eAK7B,GAAMC,CAAAA,YAAY,CAAG9B,UAAU,CAACM,kBAAD,CAA/B,CACA,GAAMyB,CAAAA,OAAO,CAAGvB,SAAS,EAAzB,CAEA,GAAMwB,CAAAA,SAAS,CAAG,QAAZA,CAAAA,SAAY,CAAAC,OAAO,CAAI,CAC5B,GAAMC,CAAAA,UAAU,CAAGC,IAAI,CAACC,SAAL,CAAe,CAACC,KAAK,CAAEJ,OAAR,CAAiBK,IAAI,CAAE,MAAvB,CAAf,CAAnB,CACAC,KAAK,CAAC,yCAAD,CAA4C,CAACC,IAAI,CAAEN,UAAP,CAAmBO,MAAM,CAAE,MAA3B,CAAmCC,OAAO,CAAE,CAAC,eAAgB,kBAAjB,CAA5C,CAA5C,CAAL,CACEC,IADF,CACO,SAAAC,QAAQ,CAAI,CACjB,GAAI,CAACA,QAAQ,CAACC,EAAd,CAAkB,CACjBhB,eAAe,CAAC,OAAD,CAAf,CACA,CACD,MAAOe,CAAAA,QAAQ,CAACE,IAAT,EAAP,CACA,CANF,EAOEH,IAPF,CAOO,SAAAC,QAAQ,CAAI,CACjB,GAAIA,QAAQ,CAACN,IAAT,EAAiBM,QAAQ,CAACN,IAAT,CAAcS,MAAnC,CAA2C,CAC1C,GAAMvB,CAAAA,KAAI,CAAGjB,cAAc,CAACqC,QAAQ,CAACN,IAAV,CAA3B,CACAb,OAAO,CAACD,KAAD,CAAP,CACA,CAHD,IAGO,CACNK,eAAe,CAAC,eAAeI,OAAhB,CAAf,CACA,CACD,CAdF,EAeEe,KAfF,CAeQ,SAAAC,GAAG,CAAI,CACb,GAAIA,GAAG,CAACC,OAAJ,CAAYC,QAAZ,CAAqB,8CAArB,CAAJ,CAA0E,CACzEtB,eAAe,CAAC,iBAAD,CAAf,CACA,CAFD,IAEO,CACNA,eAAe,CAACoB,GAAG,CAACC,OAAL,CAAf,CACA,EACD,CArBF,EAsBA,CAxBD,CA0BApD,SAAS,CAAC,UAAM,CACf,GAAIgC,YAAY,CAACsB,WAAb,CAAyBC,OAAzB,CAAiC7B,IAArC,CAA2C,CAC1C,GAAMA,CAAAA,MAAI,CAAGW,IAAI,CAACmB,KAAL,CAAW/B,eAAX,EAA4BC,IAAzC,CACAC,OAAO,CAAC,CAAC8B,UAAU,CAAC/B,MAAI,CAAC,CAAD,CAAL,CAAX,CAAqB+B,UAAU,CAAC/B,MAAI,CAAC,CAAD,CAAL,CAA/B,CAAyC+B,UAAU,CAAC/B,MAAI,CAAC,CAAD,CAAL,CAAnD,CAA6D+B,UAAU,CAAC/B,MAAI,CAAC,CAAD,CAAL,CAAvE,CAAD,CAAP,CACA,CAHD,IAGO,CACN,GAAMS,CAAAA,OAAO,CAAGH,YAAY,CAACsB,WAAb,CAAyBC,OAAzB,CAAiChB,KAAjD,CACAL,SAAS,CAACC,OAAD,CAAT,CACA,CACD;AACA,CATQ,CASN,CAACH,YAAY,CAACsB,WAAb,CAAyBC,OAA1B,CATM,CAAT,CAWAvD,SAAS,CAAC,UAAM,CACf,GAAI0B,IAAJ,CAAU,CACT;AACAG,YAAY,CAAC,CAAE,CAACH,IAAI,CAAC,CAAD,CAAL,CAASA,IAAI,CAAC,CAAD,CAAb,CAAF,CAAqB,CAACA,IAAI,CAAC,CAAD,CAAL,CAASA,IAAI,CAAC,CAAD,CAAb,CAArB,CAAwC,CAACA,IAAI,CAAC,CAAD,CAAL,CAASA,IAAI,CAAC,CAAD,CAAb,CAAxC,CAA2D,CAACA,IAAI,CAAC,CAAD,CAAL,CAASA,IAAI,CAAC,CAAD,CAAb,CAA3D,CAAD,CAAZ,CACA,CACD;AACA,CANQ,CAMN,CAACA,IAAD,CANM,CAAT,CASA,mBACC,wCACC,YAAK,SAAS,CAAEO,OAAO,CAAChB,YAAxB,UAECS,IAAI,eACJ,MAAC,YAAD,EACC,MAAM,CAAE,CAAC,CAACA,IAAI,CAAC,CAAD,CAAL,CAAUA,IAAI,CAAC,CAAD,CAAd,CAAD,CAAqB,CAACA,IAAI,CAAC,CAAD,CAAL,CAAUA,IAAI,CAAC,CAAD,CAAd,CAArB,CADT,CAEC,WAAW,CAAE,IAFd,CAGC,eAAe,CAAE,IAHlB,CAIC,kBAAkB,CAAE,IAJrB,wBAMC,KAAC,SAAD,EACC,GAAG,CAAC,qEADL,CAEC,WAAW,CAAC,mJAFb,EAND,CAWEE,SAAS,eACT,KAAC,OAAD,EACC,WAAW,CAAE,CAAC8B,KAAK,CAAC,WAAP,CAAoBC,MAAM,CAAC,CAA3B,CAA8BC,IAAI,CAAC,KAAnC,CAA0CC,OAAO,CAAC,GAAlD,CADd,CAEC,SAAS,CAAEjC,SAFZ,EAZF,CAkBEA,SAAS,EAAIJ,MAAb,eACA,KAAC,YAAD,EACC,GAAG,CAAEA,MADN,CAEC,MAAM,CAAEI,SAFT,CAGC,OAAO,CAAE,GAHV,CAIC,MAAM,CAAE,EAJT,EAnBF,GAHD,EADD,CAoCEE,YAAY,eACZ,+BAAWA,YAAX,GArCF,GADD,CA0CA,CAhGD,CAkGA,cAAeR,CAAAA,UAAf","sourcesContent":["import React, { useEffect, useState, useContext } from 'react';\nimport { MapContainer, TileLayer, Polygon, ImageOverlay } from 'react-leaflet'\nimport { makeStyles } from '@material-ui/core/styles';\nimport InputParamsContext from './InputParamsContext';\nimport { multiStateBbox } from '../utilities/utils';\n\nconst useStyles = makeStyles((theme) => ({\n\tnav: {\n\t\tposition: \"absolute\",\n\t\ttop: 0,\n\t\tleft: 0,\n\t\tpadding: \"3px\",\n\t},\n\tmapContainer: {\n\t\tborder: \"1pt solid midnightblue\",\n\t\theight: window.innerHeight * 0.6,\n\t},\n}));\n\nconst LeafletMap = (props) => {\n\tconst { imgsrc, submittedParams } = props;\n\tconst [ bbox, setBbox ] = useState();\n\tconst [ imgcoords, setImgcoords ] = useState();\n\tconst [ resultsError, setResultsError ] = useState();\n\tconst inputContext = useContext(InputParamsContext);\n\tconst classes = useStyles();\n\n\tconst fetchBbox = postals => {\n\t\tconst jsonparams = JSON.stringify({state: postals, meta: \"bbox\"});\n\t\tfetch(\"https://data.rcc-acis.org/General/state\", {body: jsonparams, method: \"POST\", headers: {'Content-Type': 'application/json'}})\n\t\t\t.then(response => {\n\t\t\t\tif (!response.ok) {\n\t\t\t\t\tsetResultsError(\"Error\");\n\t\t\t\t}\n\t\t\t\treturn response.json();\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\tif (response.meta && response.meta.length) {\n\t\t\t\t\tconst bbox = multiStateBbox(response.meta);\n\t\t\t\t\tsetBbox(bbox);\n\t\t\t\t} else {\n\t\t\t\t\tsetResultsError(\"No bbox for \"+postals);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tif (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n\t\t\t\t\tsetResultsError(\"Invalid request\");\n\t\t\t\t} else {\n\t\t\t\t\tsetResultsError(err.message);\n\t\t\t\t};\n\t\t\t})\n\t};\n\n\tuseEffect(() => {\n\t\tif (inputContext.inputParams.areaDef.bbox) {\n\t\t\tconst bbox = JSON.parse(submittedParams).bbox;\n\t\t\tsetBbox([parseFloat(bbox[0]),parseFloat(bbox[1]),parseFloat(bbox[2]),parseFloat(bbox[3])]);\n\t\t} else {\n\t\t\tconst postals = inputContext.inputParams.areaDef.state;\n\t\t\tfetchBbox(postals);\n\t\t}\n\t\t// eslint-disable-next-line \n\t}, [inputContext.inputParams.areaDef]);\n\n\tuseEffect(() => {\n\t\tif (bbox) {\n\t\t\t// convert bbox to Leaflet coordinates\n\t\t\tsetImgcoords([ [bbox[3],bbox[0]], [bbox[3],bbox[2]], [bbox[1],bbox[2]], [bbox[1],bbox[0]] ]);\n\t\t}\n\t\t// eslint-disable-next-line \n\t}, [bbox]);\n\n\n\treturn (\n\t\t<>\n\t\t\t<div className={classes.mapContainer}>\n\n\t\t\t{bbox && \n\t\t\t\t<MapContainer \n\t\t\t\t\tbounds={[[bbox[1], bbox[0]], [bbox[3], bbox[2]]]}\n\t\t\t\t\tzoomControl={true}\n\t\t\t\t\tscrollWheelZoom={true}\n\t\t\t\t\tattributionControl={true}\n\t\t\t\t>\n\t\t\t\t\t<TileLayer\n\t\t\t\t\t\turl='https://{s}.basemaps.cartocdn.com/light_nolabels/{z}/{x}/{y}{r}.png'\n\t\t\t\t\t\tattribution='&copy; <a href=\"https://www.openstreetmap.org/copyright\">OpenStreetMap</a> contributors &copy; <a href=\"https://carto.com/attributions\">CARTO</a>'\n\t\t\t\t\t/>\n\n\t\t\t\t\t{imgcoords &&\n\t\t\t\t\t\t<Polygon \n\t\t\t\t\t\t\tpathOptions={{color:\"lightgray\", weight:1, fill:false, opacity:0.8}}\n\t\t\t\t\t\t\tpositions={imgcoords} \n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\n\t\t\t\t\t{imgcoords && imgsrc &&\n\t\t\t\t\t\t<ImageOverlay\n\t\t\t\t\t\t\turl={imgsrc}\n\t\t\t\t\t\t\tbounds={imgcoords}\n\t\t\t\t\t\t\topacity={0.8}\n\t\t\t\t\t\t\tzIndex={10}\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\n\t\t\t\t</MapContainer>\n\t\t\t}\n\n\t\t\t\t\n\t\t\t</div>\n\t\t\t{resultsError &&\n\t\t\t\t<p>Error: {resultsError}</p>\n\t\t\t}\n\t\t</>\n\t);\n}\n\nexport default LeafletMap;\n"]},"metadata":{},"sourceType":"module"}