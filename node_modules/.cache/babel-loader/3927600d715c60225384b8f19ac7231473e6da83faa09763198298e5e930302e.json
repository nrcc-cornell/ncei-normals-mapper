{"ast":null,"code":"var _jsxFileName = \"/Users/keith/progs/React/ncei-normals-mapper/src/components/GetResults.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState, useContext } from \"react\";\nimport CircularProgress from \"@mui/material/CircularProgress\";\nimport InputParamsContext from './InputParamsContext';\nimport { buildParams } from '../utilities/utils';\nimport DisplayMap from \"./DisplayMap\";\nimport DisplayJson from \"./DisplayJson\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst GetResults = () => {\n  _s();\n  const [mapBlob, setMapBlob] = useState();\n  const [jsonresp, setJsonresp] = useState();\n  const [imgInfo, setImgInfo] = useState();\n  const [resultsError, setResultsError] = useState();\n  const [loading, setLoading] = useState(false);\n  const [submittedParams, setSubmittedParams] = useState();\n  const inputContext = useContext(InputParamsContext);\n  const fetchResponse = (params, output) => {\n    const infoInput = JSON.stringify({\n      ...params,\n      output: \"json\"\n    });\n    console.log(infoInput);\n    fetch(\"https://grid2.rcc-acis.org/GridData\", {\n      body: infoInput,\n      method: \"POST\",\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).then(response => {\n      if (!response.ok) {\n        console.log(response);\n        const message = \"Error on request\" + (response.statusText ? \": \" + response.statusText : \"\");\n        setResultsError(message);\n        //return response.json();\t// return to possibly get better message from json\n      }\n\n      return response.json();\n    }).then(response => {\n      console.log('ok');\n      if (response.error) {\n        setResultsError(response.status + \" \" + response.error);\n      } else if (output === 'png') {\n        setResultsError(\"\");\n        setMapBlob(response.data);\n        setImgInfo(response);\n      } else {\n        setResultsError(\"\");\n        setJsonresp(response.data);\n      }\n    }).catch(err => {\n      console.log('catch');\n      if (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n        setResultsError(\"Invalid grid request - \" + infoInput);\n      } else {\n        setResultsError(\"Error: \" + err.message);\n      }\n      ;\n    }).finally(x => {\n      console.log('finally ' + x);\n      setLoading(false);\n    });\n  };\n  useEffect(() => {\n    setResultsError(null);\n    setLoading(true);\n    // Build parameters\n    const input = buildParams(inputContext.inputParams);\n    // Save parameters \n    setSubmittedParams(input);\n    if (input.output === 'png' && input.image.levels) {\n      inputContext.updateLevels({\n        client: input.image.levels\n      });\n    } else {\n      inputContext.updateLevels({\n        client: []\n      });\n    }\n    // Get results\n    console.log('calling fetchresponse');\n    fetchResponse(input, input.output);\n    // eslint-disable-next-line \n  }, []);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [loading && /*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 78,\n      columnNumber: 5\n    }, this), submittedParams && (jsonresp || mapBlob) && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [mapBlob && /*#__PURE__*/_jsxDEV(DisplayMap, {\n        imgsrc: mapBlob,\n        imgInfo: imgInfo,\n        submittedParams: submittedParams\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 83,\n        columnNumber: 7\n      }, this), jsonresp && /*#__PURE__*/_jsxDEV(DisplayJson, {\n        jsonresp: jsonresp,\n        submittedParams: submittedParams\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 90,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true), resultsError && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: resultsError\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 98,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true);\n};\n_s(GetResults, \"PrDrsvMWrwAUPEJhi1lWXaD+z3Y=\");\n_c = GetResults;\nexport default GetResults;\nvar _c;\n$RefreshReg$(_c, \"GetResults\");","map":{"version":3,"names":["React","useEffect","useState","useContext","CircularProgress","InputParamsContext","buildParams","DisplayMap","DisplayJson","jsxDEV","_jsxDEV","Fragment","_Fragment","GetResults","_s","mapBlob","setMapBlob","jsonresp","setJsonresp","imgInfo","setImgInfo","resultsError","setResultsError","loading","setLoading","submittedParams","setSubmittedParams","inputContext","fetchResponse","params","output","infoInput","JSON","stringify","console","log","fetch","body","method","headers","then","response","ok","message","statusText","json","error","status","data","catch","err","includes","finally","x","input","inputParams","image","levels","updateLevels","client","children","fileName","_jsxFileName","lineNumber","columnNumber","imgsrc","_c","$RefreshReg$"],"sources":["/Users/keith/progs/React/ncei-normals-mapper/src/components/GetResults.js"],"sourcesContent":["import React, { useEffect, useState, useContext} from \"react\";\nimport CircularProgress from \"@mui/material/CircularProgress\";\nimport InputParamsContext from './InputParamsContext';\nimport { buildParams } from '../utilities/utils';\nimport DisplayMap from \"./DisplayMap\";\nimport DisplayJson from \"./DisplayJson\";\n\nconst GetResults = () => {\n\tconst [mapBlob, setMapBlob] = useState();\n\tconst [jsonresp, setJsonresp] = useState();\n\tconst [imgInfo, setImgInfo] = useState();\n\tconst [resultsError, setResultsError] = useState();\n\tconst [loading, setLoading] = useState(false);\n\tconst [submittedParams, setSubmittedParams] = useState();\n\tconst inputContext = useContext(InputParamsContext);\n\n\tconst fetchResponse = (params, output) => {\n\t\tconst infoInput = JSON.stringify({...params, output: \"json\"});\n\t\tconsole.log(infoInput)\n\t\tfetch(\"https://grid2.rcc-acis.org/GridData\", {body: infoInput, method: \"POST\", headers: {'Content-Type': 'application/json'},})\n\t\t\t.then(response => {\n\t\t\t\tif (!response.ok) {\n\t\t\t\t\tconsole.log(response)\n\t\t\t\t\tconst message = \"Error on request\" + (response.statusText ? (\": \" + response.statusText) : \"\");\n\t\t\t\t\tsetResultsError(message);\n\t\t\t\t\t//return response.json();\t// return to possibly get better message from json\n\t\t\t\t}\n\t\t\t\treturn response.json();\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\tconsole.log('ok')\n\t\t\t\tif (response.error) {\n\t\t\t\t\tsetResultsError(response.status + \" \" + response.error)\n\t\t\t\t} else if (output === 'png') {\n\t\t\t\t\tsetResultsError(\"\");\n\t\t\t\t\tsetMapBlob(response.data);\n\t\t\t\t\tsetImgInfo(response);\n\t\t\t\t} else {\n\t\t\t\t\tsetResultsError(\"\");\n\t\t\t\t\tsetJsonresp(response.data);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tconsole.log('catch')\n\t\t\t\tif (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n\t\t\t\t\tsetResultsError(\"Invalid grid request - \"+infoInput);\n\t\t\t\t} else {\n\t\t\t\t\tsetResultsError(\"Error: \" + err.message);\n\t\t\t\t};\n\t\t\t})\n\t\t\t.finally((x) => {\n\t\t\t\tconsole.log('finally '+x)\n\t\t\t\tsetLoading(false);\n\t\t\t});\n\t};\n\n\tuseEffect(() => {\n\t\tsetResultsError(null);\n\t\tsetLoading(true);\n\t\t// Build parameters\n\t\tconst input = buildParams(inputContext.inputParams);\n\t\t// Save parameters \n\t\tsetSubmittedParams(input);\n\t\tif (input.output === 'png' && input.image.levels) {\n\t\t\tinputContext.updateLevels({client: input.image.levels});\n\t\t} else {\n\t\t\tinputContext.updateLevels({client: []});\n\t\t}\n\t\t// Get results\n\t\tconsole.log('calling fetchresponse')\n\t\tfetchResponse(input, input.output);\n\t\t// eslint-disable-next-line \n\t}, []);\n\n\treturn (\n\t\t<>\n\t\t\t{loading &&\n\t\t\t\t<CircularProgress />\n\t\t\t}\n\t\t\t{submittedParams && (jsonresp || mapBlob) &&\n\t\t\t\t<>\n\t\t\t\t\t{mapBlob &&\n\t\t\t\t\t\t<DisplayMap \n\t\t\t\t\t\t\timgsrc={mapBlob}\n\t\t\t\t\t\t\timgInfo={imgInfo}\n\t\t\t\t\t\t\tsubmittedParams={submittedParams}\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t\t{jsonresp &&\n\t\t\t\t\t\t<DisplayJson\n\t\t\t\t\t\t\tjsonresp={jsonresp}\n\t\t\t\t\t\t\tsubmittedParams={submittedParams}\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t</>\n\t\t\t}\n\t\t\t{resultsError &&\n\t\t\t\t<p>{resultsError}</p>\n\t\t\t}\n\t\t</>\n\t);\n}\n\nexport default GetResults;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}