{"ast":null,"code":"var _jsxFileName = \"/Users/keith/progs/React/ncei-normals-mapper/src/components/GetResults.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport CircularProgress from \"@mui/material/CircularProgress\";\nimport { buildParams } from '../utilities/utils';\nimport DisplayMap from \"./DisplayMap\";\nimport DisplayJson from \"./DisplayJson\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst GetResults = props => {\n  _s();\n  const {\n    inputParams,\n    updateLevels\n  } = props;\n  const [mapBlob, setMapBlob] = useState();\n  const [jsonresp, setJsonresp] = useState();\n  const [imgInfo, setImgInfo] = useState();\n  const [resultsError, setResultsError] = useState();\n  const [loading, setLoading] = useState(false);\n  const [submittedParams, setSubmittedParams] = useState();\n  const fetchResponse = (params, output) => {\n    const infoInput = JSON.stringify({\n      ...params,\n      output: \"json\"\n    });\n    fetch(\"https://grid2.rcc-acis.org/GridData\", {\n      body: infoInput,\n      method: \"POST\",\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).then(response => {\n      if (!response.ok) {\n        const message = \"Error on request\" + (response.statusText ? \": \" + response.statusText : \"\");\n        setResultsError(message);\n        return response.json(); // return to possibly get better message from json\n      }\n\n      return response.json();\n    }).then(response => {\n      if (response.error) {\n        //setResultsError(response.status + \" \" + response.error)\n        //always getting extraneous call returning status:\"invalid request.\" and error:\"unknown image return type: text/plain\"\n        //suppressing\n        setResultsError(\"\");\n      } else if (output === 'png') {\n        setResultsError(\"\");\n        setMapBlob(response.data);\n        setImgInfo(response);\n      } else {\n        setResultsError(\"\");\n        setJsonresp(response.data);\n      }\n    }).catch(err => {\n      if (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n        setResultsError(\"Invalid grid request - \" + infoInput);\n      } else {\n        setResultsError(\"Error: \" + err.message);\n      }\n      ;\n    }).finally(() => {\n      setLoading(false);\n    });\n  };\n  useEffect(() => {\n    setResultsError(null);\n    setLoading(true);\n    // Build parameters\n    const input = buildParams(inputParams);\n    // Save parameters \n    setSubmittedParams(input);\n    if (input.output === 'png' && input.image.levels) {\n      updateLevels({\n        client: input.image.levels\n      });\n    } else {\n      updateLevels({\n        client: []\n      });\n    }\n    // Get results\n    fetchResponse(input, input.output);\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [inputParams]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: [loading && /*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 74,\n      columnNumber: 5\n    }, this), submittedParams && (jsonresp || mapBlob) && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [mapBlob && /*#__PURE__*/_jsxDEV(DisplayMap, {\n        imgsrc: mapBlob,\n        imgInfo: imgInfo,\n        submittedParams: submittedParams\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 79,\n        columnNumber: 7\n      }, this), jsonresp && /*#__PURE__*/_jsxDEV(DisplayJson, {\n        jsonresp: jsonresp,\n        submittedParams: submittedParams\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 86,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true), resultsError && /*#__PURE__*/_jsxDEV(\"p\", {\n      children: resultsError\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 94,\n      columnNumber: 5\n    }, this)]\n  }, void 0, true);\n};\n_s(GetResults, \"Sm4EtUl5jb1MvlrLGcay91wsFlE=\");\n_c = GetResults;\nexport default GetResults;\nvar _c;\n$RefreshReg$(_c, \"GetResults\");","map":{"version":3,"names":["React","useEffect","useState","CircularProgress","buildParams","DisplayMap","DisplayJson","jsxDEV","_jsxDEV","Fragment","_Fragment","GetResults","props","_s","inputParams","updateLevels","mapBlob","setMapBlob","jsonresp","setJsonresp","imgInfo","setImgInfo","resultsError","setResultsError","loading","setLoading","submittedParams","setSubmittedParams","fetchResponse","params","output","infoInput","JSON","stringify","fetch","body","method","headers","then","response","ok","message","statusText","json","error","data","catch","err","includes","finally","input","image","levels","client","children","fileName","_jsxFileName","lineNumber","columnNumber","imgsrc","_c","$RefreshReg$"],"sources":["/Users/keith/progs/React/ncei-normals-mapper/src/components/GetResults.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport CircularProgress from \"@mui/material/CircularProgress\";\nimport { buildParams } from '../utilities/utils';\nimport DisplayMap from \"./DisplayMap\";\nimport DisplayJson from \"./DisplayJson\";\n\nconst GetResults = (props) => {\n\tconst { inputParams, updateLevels } = props;\n\tconst [mapBlob, setMapBlob] = useState();\n\tconst [jsonresp, setJsonresp] = useState();\n\tconst [imgInfo, setImgInfo] = useState();\n\tconst [resultsError, setResultsError] = useState();\n\tconst [loading, setLoading] = useState(false);\n\tconst [submittedParams, setSubmittedParams] = useState();\n\n\tconst fetchResponse = (params, output) => {\n\t\tconst infoInput = JSON.stringify({...params, output: \"json\"});\n\t\tfetch(\"https://grid2.rcc-acis.org/GridData\", {body: infoInput, method: \"POST\", headers: {'Content-Type': 'application/json'},})\n\t\t\t.then(response => {\n\t\t\t\tif (!response.ok) {\n\t\t\t\t\tconst message = \"Error on request\" + (response.statusText ? (\": \" + response.statusText) : \"\");\n\t\t\t\t\tsetResultsError(message);\n\t\t\t\t\treturn response.json();\t// return to possibly get better message from json\n\t\t\t\t}\n\t\t\t\treturn response.json();\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\tif (response.error) {\n\t\t\t\t\t//setResultsError(response.status + \" \" + response.error)\n\t\t\t\t\t//always getting extraneous call returning status:\"invalid request.\" and error:\"unknown image return type: text/plain\"\n\t\t\t\t\t//suppressing\n\t\t\t\t\tsetResultsError(\"\");\n\t\t\t\t} else if (output === 'png') {\n\t\t\t\t\tsetResultsError(\"\");\n\t\t\t\t\tsetMapBlob(response.data);\n\t\t\t\t\tsetImgInfo(response);\n\t\t\t\t} else {\n\t\t\t\t\tsetResultsError(\"\");\n\t\t\t\t\tsetJsonresp(response.data);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tif (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n\t\t\t\t\tsetResultsError(\"Invalid grid request - \"+infoInput);\n\t\t\t\t} else {\n\t\t\t\t\tsetResultsError(\"Error: \" + err.message);\n\t\t\t\t};\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tsetLoading(false);\n\t\t\t});\n\t};\n\n\tuseEffect(() => {\n\t\tsetResultsError(null);\n\t\tsetLoading(true);\n\t\t// Build parameters\n\t\tconst input = buildParams(inputParams);\n\t\t// Save parameters \n\t\tsetSubmittedParams(input);\n\t\tif (input.output === 'png' && input.image.levels) {\n\t\t\tupdateLevels({client: input.image.levels});\n\t\t} else {\n\t\t\tupdateLevels({client: []});\n\t\t}\n\t\t// Get results\n\t\tfetchResponse(input, input.output);\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [inputParams]);\n\n\treturn (\n\t\t<>\n\t\t\t{loading &&\n\t\t\t\t<CircularProgress />\n\t\t\t}\n\t\t\t{submittedParams && (jsonresp || mapBlob) &&\n\t\t\t\t<>\n\t\t\t\t\t{mapBlob &&\n\t\t\t\t\t\t<DisplayMap \n\t\t\t\t\t\t\timgsrc={mapBlob}\n\t\t\t\t\t\t\timgInfo={imgInfo}\n\t\t\t\t\t\t\tsubmittedParams={submittedParams}\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t\t{jsonresp &&\n\t\t\t\t\t\t<DisplayJson\n\t\t\t\t\t\t\tjsonresp={jsonresp}\n\t\t\t\t\t\t\tsubmittedParams={submittedParams}\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t</>\n\t\t\t}\n\t\t\t{resultsError &&\n\t\t\t\t<p>{resultsError}</p>\n\t\t\t}\n\t\t</>\n\t);\n}\n\nexport default GetResults;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}