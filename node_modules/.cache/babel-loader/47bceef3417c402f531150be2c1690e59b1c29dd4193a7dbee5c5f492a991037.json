{"ast":null,"code":"var _jsxFileName = \"/Users/keith/progs/React/ncei-normals-mapper/src/components/GetResults.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useState } from \"react\";\nimport CircularProgress from \"@mui/material/CircularProgress\";\nimport { buildParams } from '../utilities/utils';\nimport DisplayMap from \"./DisplayMap\";\nimport DisplayJson from \"./DisplayJson\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nimport { Fragment as _Fragment } from \"react/jsx-dev-runtime\";\nconst GetResults = props => {\n  _s();\n  const {\n    inputParams,\n    levels,\n    updateLevels,\n    updateColors,\n    viewMap\n  } = props;\n  const [mapBlob, setMapBlob] = useState(false);\n  const [jsonresp, setJsonresp] = useState(false);\n  const [imgInfo, setImgInfo] = useState(false);\n  const [resultsError, setResultsError] = useState();\n  const [loading, setLoading] = useState(false);\n  const [submittedParams, setSubmittedParams] = useState();\n  const fetchResponse = (params, output) => {\n    const infoInput = JSON.stringify({\n      ...params,\n      output: \"json\"\n    });\n    fetch(\"https://grid2.rcc-acis.org/GridData\", {\n      body: infoInput,\n      method: \"POST\",\n      headers: {\n        'Content-Type': 'application/json'\n      }\n    }).then(response => {\n      if (!response.ok) {\n        const message = \"Error on request\" + (response.statusText ? \": \" + response.statusText : \"\");\n        setResultsError(message);\n        return response.json(); // return to possibly get better message from json\n      }\n\n      return response.json();\n    }).then(response => {\n      if (response.error) {\n        //setResultsError(response.status + \" \" + response.error)\n        //always getting extraneous call returning status:\"invalid request.\" and error:\"unknown image return type: text/plain\"\n        //suppressing\n        setResultsError(\"\");\n      } else if (output === 'png') {\n        setResultsError(\"\");\n        setMapBlob(response.data);\n        setJsonresp(false);\n        setImgInfo(response);\n      } else {\n        setResultsError(\"\");\n        setMapBlob(false);\n        setJsonresp(response.data);\n        setImgInfo(false);\n      }\n    }).catch(err => {\n      if (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n        setResultsError(\"Invalid grid request - \" + infoInput);\n      } else {\n        setResultsError(\"Error: \" + err.message);\n      }\n      ;\n    }).finally(() => {\n      setLoading(false);\n    });\n  };\n  useEffect(() => {\n    console.log('ineffect' + viewMap);\n    if (viewMap) {\n      setResultsError(null);\n      setLoading(true);\n      // Build parameters\n      const input = buildParams(inputParams);\n      // Save parameters \n      setSubmittedParams(input);\n      if (input.output === 'png' && input.image.levels) {\n        updateLevels({\n          client: input.image.levels\n        });\n      } else {\n        updateLevels({\n          client: []\n        });\n      }\n      // Get results\n      fetchResponse(input, input.output);\n    }\n    // eslint-disable-next-line react-hooks/exhaustive-deps\n  }, [viewMap]);\n  return /*#__PURE__*/_jsxDEV(_Fragment, {\n    children: viewMap && /*#__PURE__*/_jsxDEV(_Fragment, {\n      children: [loading && /*#__PURE__*/_jsxDEV(CircularProgress, {}, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 82,\n        columnNumber: 7\n      }, this), submittedParams && (jsonresp || mapBlob) && /*#__PURE__*/_jsxDEV(_Fragment, {\n        children: [mapBlob && /*#__PURE__*/_jsxDEV(DisplayMap, {\n          imgsrc: mapBlob,\n          imgInfo: imgInfo,\n          submittedParams: submittedParams,\n          inputParams: inputParams,\n          levels: levels,\n          updateLevels: updateLevels,\n          updateColors: updateColors\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 87,\n          columnNumber: 9\n        }, this), jsonresp && /*#__PURE__*/_jsxDEV(DisplayJson, {\n          jsonresp: jsonresp,\n          submittedParams: submittedParams\n        }, void 0, false, {\n          fileName: _jsxFileName,\n          lineNumber: 98,\n          columnNumber: 9\n        }, this)]\n      }, void 0, true), resultsError && /*#__PURE__*/_jsxDEV(\"p\", {\n        children: resultsError\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 106,\n        columnNumber: 7\n      }, this)]\n    }, void 0, true)\n  }, void 0, false);\n};\n_s(GetResults, \"/DpulD0bxoxh4UCA+dA3ktfwsC0=\");\n_c = GetResults;\nexport default GetResults;\nvar _c;\n$RefreshReg$(_c, \"GetResults\");","map":{"version":3,"names":["React","useEffect","useState","CircularProgress","buildParams","DisplayMap","DisplayJson","jsxDEV","_jsxDEV","Fragment","_Fragment","GetResults","props","_s","inputParams","levels","updateLevels","updateColors","viewMap","mapBlob","setMapBlob","jsonresp","setJsonresp","imgInfo","setImgInfo","resultsError","setResultsError","loading","setLoading","submittedParams","setSubmittedParams","fetchResponse","params","output","infoInput","JSON","stringify","fetch","body","method","headers","then","response","ok","message","statusText","json","error","data","catch","err","includes","finally","console","log","input","image","client","children","fileName","_jsxFileName","lineNumber","columnNumber","imgsrc","_c","$RefreshReg$"],"sources":["/Users/keith/progs/React/ncei-normals-mapper/src/components/GetResults.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport CircularProgress from \"@mui/material/CircularProgress\";\nimport { buildParams } from '../utilities/utils';\nimport DisplayMap from \"./DisplayMap\";\nimport DisplayJson from \"./DisplayJson\";\n\nconst GetResults = (props) => {\n\tconst { inputParams, levels, updateLevels, updateColors, viewMap } = props;\n\tconst [mapBlob, setMapBlob] = useState(false);\n\tconst [jsonresp, setJsonresp] = useState(false);\n\tconst [imgInfo, setImgInfo] = useState(false);\n\tconst [resultsError, setResultsError] = useState();\n\tconst [loading, setLoading] = useState(false);\n\tconst [submittedParams, setSubmittedParams] = useState();\n\n\tconst fetchResponse = (params, output) => {\n\t\tconst infoInput = JSON.stringify({...params, output: \"json\"});\n\t\tfetch(\"https://grid2.rcc-acis.org/GridData\", {body: infoInput, method: \"POST\", headers: {'Content-Type': 'application/json'},})\n\t\t\t.then(response => {\n\t\t\t\tif (!response.ok) {\n\t\t\t\t\tconst message = \"Error on request\" + (response.statusText ? (\": \" + response.statusText) : \"\");\n\t\t\t\t\tsetResultsError(message);\n\t\t\t\t\treturn response.json();\t// return to possibly get better message from json\n\t\t\t\t}\n\t\t\t\treturn response.json();\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\tif (response.error) {\n\t\t\t\t\t//setResultsError(response.status + \" \" + response.error)\n\t\t\t\t\t//always getting extraneous call returning status:\"invalid request.\" and error:\"unknown image return type: text/plain\"\n\t\t\t\t\t//suppressing\n\t\t\t\t\tsetResultsError(\"\");\n\t\t\t\t} else if (output === 'png') {\n\t\t\t\t\tsetResultsError(\"\");\n\t\t\t\t\tsetMapBlob(response.data);\n\t\t\t\t\tsetJsonresp(false);\n\t\t\t\t\tsetImgInfo(response);\n\t\t\t\t} else {\n\t\t\t\t\tsetResultsError(\"\");\n\t\t\t\t\tsetMapBlob(false);\n\t\t\t\t\tsetJsonresp(response.data);\n\t\t\t\t\tsetImgInfo(false);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tif (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n\t\t\t\t\tsetResultsError(\"Invalid grid request - \"+infoInput);\n\t\t\t\t} else {\n\t\t\t\t\tsetResultsError(\"Error: \" + err.message);\n\t\t\t\t};\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tsetLoading(false);\n\t\t\t});\n\t};\n\n\tuseEffect(() => {\n\t\tconsole.log('ineffect' + viewMap)\n\t\tif (viewMap) {\n\t\tsetResultsError(null);\n\t\tsetLoading(true);\n\t\t// Build parameters\n\t\tconst input = buildParams(inputParams);\n\t\t// Save parameters \n\t\tsetSubmittedParams(input);\n\t\tif (input.output === 'png' && input.image.levels) {\n\t\t\tupdateLevels({client: input.image.levels});\n\t\t} else {\n\t\t\tupdateLevels({client: []});\n\t\t}\n\t\t// Get results\n\t\tfetchResponse(input, input.output);\n\t\t}\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [viewMap]);\n\n\treturn (\n\t\t<>\n\t\t\t{viewMap &&\n\t\t\t\t<>\n\t\t\t\t\t{loading &&\n\t\t\t\t\t\t<CircularProgress />\n\t\t\t\t\t}\n\t\t\t\t\t{submittedParams && (jsonresp || mapBlob) &&\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{mapBlob &&\n\t\t\t\t\t\t\t\t<DisplayMap \n\t\t\t\t\t\t\t\t\timgsrc={mapBlob}\n\t\t\t\t\t\t\t\t\timgInfo={imgInfo}\n\t\t\t\t\t\t\t\t\tsubmittedParams={submittedParams}\n\t\t\t\t\t\t\t\t\tinputParams={inputParams}\n\t\t\t\t\t\t\t\t\tlevels={levels}\n\t\t\t\t\t\t\t\t\tupdateLevels={updateLevels}\n\t\t\t\t\t\t\t\t\tupdateColors={updateColors}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t{jsonresp &&\n\t\t\t\t\t\t\t\t<DisplayJson\n\t\t\t\t\t\t\t\t\tjsonresp={jsonresp}\n\t\t\t\t\t\t\t\t\tsubmittedParams={submittedParams}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</>\n\t\t\t\t\t}\n\t\t\t\t\t{resultsError &&\n\t\t\t\t\t\t<p>{resultsError}</p>\n\t\t\t\t\t}\n\t\t\t\t</>\n\t\t\t}\n\t\t</>\n\t);\n}\n\nexport default GetResults;"],"mappings":";;AAAA,OAAOA,KAAK,IAAIC,SAAS,EAAEC,QAAQ,QAAQ,OAAO;AAClD,OAAOC,gBAAgB,MAAM,gCAAgC;AAC7D,SAASC,WAAW,QAAQ,oBAAoB;AAChD,OAAOC,UAAU,MAAM,cAAc;AACrC,OAAOC,WAAW,MAAM,eAAe;AAAC,SAAAC,MAAA,IAAAC,OAAA;AAAA,SAAAC,QAAA,IAAAC,SAAA;AAExC,MAAMC,UAAU,GAAIC,KAAK,IAAK;EAAAC,EAAA;EAC7B,MAAM;IAAEC,WAAW;IAAEC,MAAM;IAAEC,YAAY;IAAEC,YAAY;IAAEC;EAAQ,CAAC,GAAGN,KAAK;EAC1E,MAAM,CAACO,OAAO,EAAEC,UAAU,CAAC,GAAGlB,QAAQ,CAAC,KAAK,CAAC;EAC7C,MAAM,CAACmB,QAAQ,EAAEC,WAAW,CAAC,GAAGpB,QAAQ,CAAC,KAAK,CAAC;EAC/C,MAAM,CAACqB,OAAO,EAAEC,UAAU,CAAC,GAAGtB,QAAQ,CAAC,KAAK,CAAC;EAC7C,MAAM,CAACuB,YAAY,EAAEC,eAAe,CAAC,GAAGxB,QAAQ,CAAC,CAAC;EAClD,MAAM,CAACyB,OAAO,EAAEC,UAAU,CAAC,GAAG1B,QAAQ,CAAC,KAAK,CAAC;EAC7C,MAAM,CAAC2B,eAAe,EAAEC,kBAAkB,CAAC,GAAG5B,QAAQ,CAAC,CAAC;EAExD,MAAM6B,aAAa,GAAGA,CAACC,MAAM,EAAEC,MAAM,KAAK;IACzC,MAAMC,SAAS,GAAGC,IAAI,CAACC,SAAS,CAAC;MAAC,GAAGJ,MAAM;MAAEC,MAAM,EAAE;IAAM,CAAC,CAAC;IAC7DI,KAAK,CAAC,qCAAqC,EAAE;MAACC,IAAI,EAAEJ,SAAS;MAAEK,MAAM,EAAE,MAAM;MAAEC,OAAO,EAAE;QAAC,cAAc,EAAE;MAAkB;IAAE,CAAC,CAAC,CAC7HC,IAAI,CAACC,QAAQ,IAAI;MACjB,IAAI,CAACA,QAAQ,CAACC,EAAE,EAAE;QACjB,MAAMC,OAAO,GAAG,kBAAkB,IAAIF,QAAQ,CAACG,UAAU,GAAI,IAAI,GAAGH,QAAQ,CAACG,UAAU,GAAI,EAAE,CAAC;QAC9FnB,eAAe,CAACkB,OAAO,CAAC;QACxB,OAAOF,QAAQ,CAACI,IAAI,CAAC,CAAC,CAAC,CAAC;MACzB;;MACA,OAAOJ,QAAQ,CAACI,IAAI,CAAC,CAAC;IACvB,CAAC,CAAC,CACDL,IAAI,CAACC,QAAQ,IAAI;MACjB,IAAIA,QAAQ,CAACK,KAAK,EAAE;QACnB;QACA;QACA;QACArB,eAAe,CAAC,EAAE,CAAC;MACpB,CAAC,MAAM,IAAIO,MAAM,KAAK,KAAK,EAAE;QAC5BP,eAAe,CAAC,EAAE,CAAC;QACnBN,UAAU,CAACsB,QAAQ,CAACM,IAAI,CAAC;QACzB1B,WAAW,CAAC,KAAK,CAAC;QAClBE,UAAU,CAACkB,QAAQ,CAAC;MACrB,CAAC,MAAM;QACNhB,eAAe,CAAC,EAAE,CAAC;QACnBN,UAAU,CAAC,KAAK,CAAC;QACjBE,WAAW,CAACoB,QAAQ,CAACM,IAAI,CAAC;QAC1BxB,UAAU,CAAC,KAAK,CAAC;MAClB;IACD,CAAC,CAAC,CACDyB,KAAK,CAACC,GAAG,IAAI;MACb,IAAIA,GAAG,CAACN,OAAO,CAACO,QAAQ,CAAC,8CAA8C,CAAC,EAAE;QACzEzB,eAAe,CAAC,yBAAyB,GAACQ,SAAS,CAAC;MACrD,CAAC,MAAM;QACNR,eAAe,CAAC,SAAS,GAAGwB,GAAG,CAACN,OAAO,CAAC;MACzC;MAAC;IACF,CAAC,CAAC,CACDQ,OAAO,CAAC,MAAM;MACdxB,UAAU,CAAC,KAAK,CAAC;IAClB,CAAC,CAAC;EACJ,CAAC;EAED3B,SAAS,CAAC,MAAM;IACfoD,OAAO,CAACC,GAAG,CAAC,UAAU,GAAGpC,OAAO,CAAC;IACjC,IAAIA,OAAO,EAAE;MACbQ,eAAe,CAAC,IAAI,CAAC;MACrBE,UAAU,CAAC,IAAI,CAAC;MAChB;MACA,MAAM2B,KAAK,GAAGnD,WAAW,CAACU,WAAW,CAAC;MACtC;MACAgB,kBAAkB,CAACyB,KAAK,CAAC;MACzB,IAAIA,KAAK,CAACtB,MAAM,KAAK,KAAK,IAAIsB,KAAK,CAACC,KAAK,CAACzC,MAAM,EAAE;QACjDC,YAAY,CAAC;UAACyC,MAAM,EAAEF,KAAK,CAACC,KAAK,CAACzC;QAAM,CAAC,CAAC;MAC3C,CAAC,MAAM;QACNC,YAAY,CAAC;UAACyC,MAAM,EAAE;QAAE,CAAC,CAAC;MAC3B;MACA;MACA1B,aAAa,CAACwB,KAAK,EAAEA,KAAK,CAACtB,MAAM,CAAC;IAClC;IACA;EACD,CAAC,EAAE,CAACf,OAAO,CAAC,CAAC;EAEb,oBACCV,OAAA,CAAAE,SAAA;IAAAgD,QAAA,EACExC,OAAO,iBACPV,OAAA,CAAAE,SAAA;MAAAgD,QAAA,GACE/B,OAAO,iBACPnB,OAAA,CAACL,gBAAgB;QAAAwD,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAE,CAAC,EAEpBjC,eAAe,KAAKR,QAAQ,IAAIF,OAAO,CAAC,iBACxCX,OAAA,CAAAE,SAAA;QAAAgD,QAAA,GACEvC,OAAO,iBACPX,OAAA,CAACH,UAAU;UACV0D,MAAM,EAAE5C,OAAQ;UAChBI,OAAO,EAAEA,OAAQ;UACjBM,eAAe,EAAEA,eAAgB;UACjCf,WAAW,EAAEA,WAAY;UACzBC,MAAM,EAAEA,MAAO;UACfC,YAAY,EAAEA,YAAa;UAC3BC,YAAY,EAAEA;QAAa;UAAA0C,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OAC3B,CAAC,EAEFzC,QAAQ,iBACRb,OAAA,CAACF,WAAW;UACXe,QAAQ,EAAEA,QAAS;UACnBQ,eAAe,EAAEA;QAAgB;UAAA8B,QAAA,EAAAC,YAAA;UAAAC,UAAA;UAAAC,YAAA;QAAA,OACjC,CAAC;MAAA,eAEF,CAAC,EAEHrC,YAAY,iBACZjB,OAAA;QAAAkD,QAAA,EAAIjC;MAAY;QAAAkC,QAAA,EAAAC,YAAA;QAAAC,UAAA;QAAAC,YAAA;MAAA,OAAI,CAAC;IAAA,eAErB;EAAC,gBAEH,CAAC;AAEL,CAAC;AAAAjD,EAAA,CAzGKF,UAAU;AAAAqD,EAAA,GAAVrD,UAAU;AA2GhB,eAAeA,UAAU;AAAC,IAAAqD,EAAA;AAAAC,YAAA,CAAAD,EAAA"},"metadata":{},"sourceType":"module","externalDependencies":[]}