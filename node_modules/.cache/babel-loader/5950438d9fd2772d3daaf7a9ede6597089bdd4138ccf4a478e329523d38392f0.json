{"ast":null,"code":"import _objectSpread from\"/Users/keith/progs/React/ncei-normals-mapper/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/keith/progs/React/ncei-normals-mapper/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from\"react\";import CircularProgress from\"@mui/material/CircularProgress\";import{buildParams}from'../utilities/utils';import DisplayMap from\"./DisplayMap\";import DisplayJson from\"./DisplayJson\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var GetResults=function GetResults(props){var inputParams=props.inputParams,levels=props.levels,updateLevels=props.updateLevels,updateColors=props.updateColors,viewMap=props.viewMap;var _useState=useState(false),_useState2=_slicedToArray(_useState,2),mapBlob=_useState2[0],setMapBlob=_useState2[1];var _useState3=useState(false),_useState4=_slicedToArray(_useState3,2),jsonresp=_useState4[0],setJsonresp=_useState4[1];var _useState5=useState(false),_useState6=_slicedToArray(_useState5,2),imgInfo=_useState6[0],setImgInfo=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),resultsError=_useState8[0],setResultsError=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),loading=_useState10[0],setLoading=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),submittedParams=_useState12[0],setSubmittedParams=_useState12[1];var fetchResponse=function fetchResponse(params,output){var infoInput=JSON.stringify(_objectSpread(_objectSpread({},params),{},{output:\"json\"}));fetch(\"https://grid2.rcc-acis.org/GridData\",{body:infoInput,method:\"POST\",headers:{'Content-Type':'application/json'}}).then(function(response){if(!response.ok){var message=\"Error on request\"+(response.statusText?\": \"+response.statusText:\"\");setResultsError(message);return response.json();// return to possibly get better message from json\n}return response.json();}).then(function(response){if(response.error){//setResultsError(response.status + \" \" + response.error)\n//always getting extraneous call returning status:\"invalid request.\" and error:\"unknown image return type: text/plain\"\n//suppressing\nsetResultsError(\"\");}else if(output==='png'){setResultsError(\"\");setImgInfo(response);setJsonresp(false);setMapBlob(response.data);}else{setResultsError(\"\");setMapBlob(false);setJsonresp(response.data);setImgInfo(false);}}).catch(function(err){if(err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")){setResultsError(\"Invalid grid request - \"+infoInput);}else{setResultsError(\"Error: \"+err.message);};}).finally(function(){setLoading(false);});};useEffect(function(){if(viewMap){setResultsError(null);setLoading(true);// Build parameters\nvar input=buildParams(inputParams);// Save parameters \nsetSubmittedParams(input);if(input.output==='png'&&input.image.levels){updateLevels({client:input.image.levels});}else{updateLevels({client:[]});}// Get results\nfetchResponse(input,input.output);}// eslint-disable-next-line react-hooks/exhaustive-deps\n},[viewMap]);return/*#__PURE__*/_jsx(_Fragment,{children:viewMap&&/*#__PURE__*/_jsxs(_Fragment,{children:[loading&&/*#__PURE__*/_jsx(CircularProgress,{}),submittedParams&&!loading&&(jsonresp||mapBlob)&&/*#__PURE__*/_jsxs(_Fragment,{children:[mapBlob&&/*#__PURE__*/_jsx(DisplayMap,{imgsrc:mapBlob,imgInfo:imgInfo,submittedParams:submittedParams,inputParams:inputParams,levels:levels,updateLevels:updateLevels,updateColors:updateColors}),jsonresp&&/*#__PURE__*/_jsx(DisplayJson,{jsonresp:jsonresp,submittedParams:submittedParams,inputParams:inputParams})]}),resultsError&&/*#__PURE__*/_jsx(\"p\",{children:resultsError})]})});};export default GetResults;","map":{"version":3,"names":["React","useEffect","useState","CircularProgress","buildParams","DisplayMap","DisplayJson","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","GetResults","props","inputParams","levels","updateLevels","updateColors","viewMap","_useState","_useState2","_slicedToArray","mapBlob","setMapBlob","_useState3","_useState4","jsonresp","setJsonresp","_useState5","_useState6","imgInfo","setImgInfo","_useState7","_useState8","resultsError","setResultsError","_useState9","_useState10","loading","setLoading","_useState11","_useState12","submittedParams","setSubmittedParams","fetchResponse","params","output","infoInput","JSON","stringify","_objectSpread","fetch","body","method","headers","then","response","ok","message","statusText","json","error","data","catch","err","includes","finally","input","image","client","children","imgsrc"],"sources":["/Users/keith/progs/React/ncei-normals-mapper/src/components/GetResults.js"],"sourcesContent":["import React, { useEffect, useState } from \"react\";\nimport CircularProgress from \"@mui/material/CircularProgress\";\nimport { buildParams } from '../utilities/utils';\nimport DisplayMap from \"./DisplayMap\";\nimport DisplayJson from \"./DisplayJson\";\n\nconst GetResults = (props) => {\n\tconst { inputParams, levels, updateLevels, updateColors, viewMap } = props;\n\tconst [mapBlob, setMapBlob] = useState(false);\n\tconst [jsonresp, setJsonresp] = useState(false);\n\tconst [imgInfo, setImgInfo] = useState(false);\n\tconst [resultsError, setResultsError] = useState();\n\tconst [loading, setLoading] = useState(false);\n\tconst [submittedParams, setSubmittedParams] = useState();\n\n\tconst fetchResponse = (params, output) => {\n\t\tconst infoInput = JSON.stringify({...params, output: \"json\"});\n\t\tfetch(\"https://grid2.rcc-acis.org/GridData\", {body: infoInput, method: \"POST\", headers: {'Content-Type': 'application/json'},})\n\t\t\t.then(response => {\n\t\t\t\tif (!response.ok) {\n\t\t\t\t\tconst message = \"Error on request\" + (response.statusText ? (\": \" + response.statusText) : \"\");\n\t\t\t\t\tsetResultsError(message);\n\t\t\t\t\treturn response.json();\t// return to possibly get better message from json\n\t\t\t\t}\n\t\t\t\treturn response.json();\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\tif (response.error) {\n\t\t\t\t\t//setResultsError(response.status + \" \" + response.error)\n\t\t\t\t\t//always getting extraneous call returning status:\"invalid request.\" and error:\"unknown image return type: text/plain\"\n\t\t\t\t\t//suppressing\n\t\t\t\t\tsetResultsError(\"\");\n\t\t\t\t} else if (output === 'png') {\n\t\t\t\t\tsetResultsError(\"\");\n\t\t\t\t\tsetImgInfo(response);\n\t\t\t\t\tsetJsonresp(false);\n\t\t\t\t\tsetMapBlob(response.data);\n\t\t\t\t} else {\n\t\t\t\t\tsetResultsError(\"\");\n\t\t\t\t\tsetMapBlob(false);\n\t\t\t\t\tsetJsonresp(response.data);\n\t\t\t\t\tsetImgInfo(false);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tif (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n\t\t\t\t\tsetResultsError(\"Invalid grid request - \"+infoInput);\n\t\t\t\t} else {\n\t\t\t\t\tsetResultsError(\"Error: \" + err.message);\n\t\t\t\t};\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tsetLoading(false);\n\t\t\t});\n\t};\n\n\tuseEffect(() => {\n\t\tif (viewMap) {\n\t\t\tsetResultsError(null);\n\t\t\tsetLoading(true);\n\t\t\t// Build parameters\n\t\t\tconst input = buildParams(inputParams);\n\t\t\t// Save parameters \n\t\t\tsetSubmittedParams(input);\n\t\t\tif (input.output === 'png' && input.image.levels) {\n\t\t\t\tupdateLevels({client: input.image.levels});\n\t\t\t} else {\n\t\t\t\tupdateLevels({client: []});\n\t\t\t}\n\t\t\t// Get results\n\t\t\tfetchResponse(input, input.output);\n\t\t}\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [viewMap]);\n\n\treturn (\n\t\t<>\n\t\t\t{viewMap &&\n\t\t\t\t<>\n\t\t\t\t\t{loading &&\n\t\t\t\t\t\t<CircularProgress />\n\t\t\t\t\t}\n\t\t\t\t\t{submittedParams && !loading && (jsonresp || mapBlob) &&\n\t\t\t\t\t\t<>\n\t\t\t\t\t\t\t{mapBlob &&\n\t\t\t\t\t\t\t\t<DisplayMap \n\t\t\t\t\t\t\t\t\timgsrc={mapBlob}\n\t\t\t\t\t\t\t\t\timgInfo={imgInfo}\n\t\t\t\t\t\t\t\t\tsubmittedParams={submittedParams}\n\t\t\t\t\t\t\t\t\tinputParams={inputParams}\n\t\t\t\t\t\t\t\t\tlevels={levels}\n\t\t\t\t\t\t\t\t\tupdateLevels={updateLevels}\n\t\t\t\t\t\t\t\t\tupdateColors={updateColors}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t\t{jsonresp &&\n\t\t\t\t\t\t\t\t<DisplayJson\n\t\t\t\t\t\t\t\t\tjsonresp={jsonresp}\n\t\t\t\t\t\t\t\t\tsubmittedParams={submittedParams}\n\t\t\t\t\t\t\t\t\tinputParams={inputParams}\n\t\t\t\t\t\t\t\t/>\n\t\t\t\t\t\t\t}\n\t\t\t\t\t\t</>\n\t\t\t\t\t}\n\t\t\t\t\t{resultsError &&\n\t\t\t\t\t\t<p>{resultsError}</p>\n\t\t\t\t\t}\n\t\t\t\t</>\n\t\t\t}\n\t\t</>\n\t);\n}\n\nexport default GetResults;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}