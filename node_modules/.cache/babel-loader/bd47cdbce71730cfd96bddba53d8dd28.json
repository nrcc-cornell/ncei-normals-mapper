{"ast":null,"code":"import _objectSpread from\"/Users/kle1/progs/React/ncei-normals-mapper/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _slicedToArray from\"/Users/kle1/progs/React/ncei-normals-mapper/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import React,{useEffect,useState,useContext}from\"react\";import CircularProgress from\"@material-ui/core/CircularProgress\";import InputParamsContext from'./InputParamsContext';import{buildParams}from'../utilities/utils';import DisplayMap from\"./DisplayMap\";import DisplayJson from\"./DisplayJson\";var GetResults=function GetResults(){var _useState=useState(),_useState2=_slicedToArray(_useState,2),mapBlob=_useState2[0],setMapBlob=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),jsonresp=_useState4[0],setJsonresp=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),imgInfo=_useState6[0],setImgInfo=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),resultsError=_useState8[0],setResultsError=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),loading=_useState10[0],setLoading=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),submittedParams=_useState12[0],setSubmittedParams=_useState12[1];var inputContext=useContext(InputParamsContext);var fetchResponse=function fetchResponse(params,output){var infoInput=JSON.stringify(_objectSpread(_objectSpread({},params),{},{output:\"json\"}));fetch(\"https://grid2.rcc-acis.org/GridData\",{body:infoInput,method:\"POST\",headers:{'Content-Type':'application/json'}}).then(function(response){if(!response.ok){var message=\"Error on request\"+(response.statusText?\": \"+response.statusText:\"\");setResultsError(message);return response.json();// return to possibly get better message from json\n}return response.json();}).then(function(response){if(response.error){setResultsError(response.status+\" \"+response.error);}else if(output==='png'){setMapBlob(response.data);setImgInfo(response);}else{setJsonresp(response.data);}}).catch(function(err){if(err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")){setResultsError(\"Invalid grid request - \"+infoInput);}else{setResultsError(\"Error: \"+err.message);};}).finally(function(){setLoading(false);});};useEffect(function(){setResultsError(null);setLoading(true);// Build parameters\nvar input=buildParams(inputContext.inputParams);// Save parameters \nsetSubmittedParams(input);if(input.output==='png'&&input.image.levels){inputContext.updateLevels({client:input.image.levels});}else{inputContext.updateLevels({client:[]});}// Get results\nfetchResponse(input,input.output);// eslint-disable-next-line react-hooks/exhaustive-deps\n},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[loading&&/*#__PURE__*/_jsx(CircularProgress,{}),submittedParams&&(jsonresp||mapBlob)&&/*#__PURE__*/_jsxs(_Fragment,{children:[mapBlob&&/*#__PURE__*/_jsx(DisplayMap,{imgsrc:mapBlob,imgInfo:imgInfo,submittedParams:submittedParams}),jsonresp&&/*#__PURE__*/_jsx(DisplayJson,{jsonresp:jsonresp,submittedParams:submittedParams})]}),resultsError&&/*#__PURE__*/_jsx(\"p\",{children:resultsError})]});};export default GetResults;","map":{"version":3,"sources":["/Users/kle1/progs/React/ncei-normals-mapper/src/components/GetResults.js"],"names":["React","useEffect","useState","useContext","CircularProgress","InputParamsContext","buildParams","DisplayMap","DisplayJson","GetResults","mapBlob","setMapBlob","jsonresp","setJsonresp","imgInfo","setImgInfo","resultsError","setResultsError","loading","setLoading","submittedParams","setSubmittedParams","inputContext","fetchResponse","params","output","infoInput","JSON","stringify","fetch","body","method","headers","then","response","ok","message","statusText","json","error","status","data","catch","err","includes","finally","input","inputParams","image","levels","updateLevels","client"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useContext} from \"react\";\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport InputParamsContext from './InputParamsContext';\nimport { buildParams } from '../utilities/utils';\nimport DisplayMap from \"./DisplayMap\";\nimport DisplayJson from \"./DisplayJson\";\n\nconst GetResults = () => {\n\tconst [mapBlob, setMapBlob] = useState();\n\tconst [jsonresp, setJsonresp] = useState();\n\tconst [imgInfo, setImgInfo] = useState();\n\tconst [resultsError, setResultsError] = useState();\n\tconst [loading, setLoading] = useState(false);\n\tconst [submittedParams, setSubmittedParams] = useState();\n\tconst inputContext = useContext(InputParamsContext);\n\n\tconst fetchResponse = (params, output) => {\n\t\tconst infoInput = JSON.stringify({...params, output: \"json\"});\n\t\tfetch(\"https://grid2.rcc-acis.org/GridData\", {body: infoInput, method: \"POST\", headers: {'Content-Type': 'application/json'},})\n\t\t\t.then(response => {\n\t\t\t\tif (!response.ok) {\n\t\t\t\t\tconst message = \"Error on request\" + (response.statusText ? (\": \" + response.statusText) : \"\");\n\t\t\t\t\tsetResultsError(message);\n\t\t\t\t\treturn response.json();\t// return to possibly get better message from json\n\t\t\t\t}\n\t\t\t\treturn response.json();\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\tif (response.error) {\n\t\t\t\t\tsetResultsError(response.status + \" \" + response.error)\n\t\t\t\t} else if (output === 'png') {\n\t\t\t\t\tsetMapBlob(response.data);\n\t\t\t\t\tsetImgInfo(response);\n\t\t\t\t} else {\n\t\t\t\t\tsetJsonresp(response.data);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tif (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n\t\t\t\t\tsetResultsError(\"Invalid grid request - \"+infoInput);\n\t\t\t\t} else {\n\t\t\t\t\tsetResultsError(\"Error: \" + err.message);\n\t\t\t\t};\n\t\t\t})\n\t\t\t.finally(() => {\n\t\t\t\tsetLoading(false);\n\t\t\t});\n\t};\n\n\tuseEffect(() => {\n\t\tsetResultsError(null);\n\t\tsetLoading(true);\n\t\t// Build parameters\n\t\tconst input = buildParams(inputContext.inputParams);\n\t\t// Save parameters \n\t\tsetSubmittedParams(input);\n\t\tif (input.output === 'png' && input.image.levels) {\n\t\t\tinputContext.updateLevels({client: input.image.levels});\n\t\t} else {\n\t\t\tinputContext.updateLevels({client: []});\n\t\t}\n\t\t// Get results\n\t\tfetchResponse(input, input.output);\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, []);\n\n\treturn (\n\t\t<>\n\t\t\t{loading &&\n\t\t\t\t<CircularProgress />\n\t\t\t}\n\t\t\t{submittedParams && (jsonresp || mapBlob) &&\n\t\t\t\t<>\n\t\t\t\t\t{mapBlob &&\n\t\t\t\t\t\t<DisplayMap \n\t\t\t\t\t\t\timgsrc={mapBlob}\n\t\t\t\t\t\t\timgInfo={imgInfo}\n\t\t\t\t\t\t\tsubmittedParams={submittedParams}\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t\t{jsonresp &&\n\t\t\t\t\t\t<DisplayJson\n\t\t\t\t\t\t\tjsonresp={jsonresp}\n\t\t\t\t\t\t\tsubmittedParams={submittedParams}\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t</>\n\t\t\t}\n\t\t\t{resultsError &&\n\t\t\t\t<p>{resultsError}</p>\n\t\t\t}\n\t\t</>\n\t);\n}\n\nexport default GetResults;"]},"metadata":{},"sourceType":"module"}