{"ast":null,"code":"import _objectSpread from\"/Users/kle1/progs/React/ncei-normals-mapper/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/Users/kle1/progs/React/ncei-normals-mapper/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import{elements,maxbbox}from'../utilities/constants';//const dateDiff = (date1, date2) => {\n//\tconst sdate = date1 instanceof Date ? date1 : new Date(date1);\n//\tconst edate = date2 instanceof Date ? date2 : new Date(date2);\n//\tconst one_day = 1000 * 60 * 60 * 24;\n//\treturn (Math.round((edate.getTime() - sdate.getTime()) / one_day));\n//};\n// check bounding box \nvar checkBbox=function checkBbox(bbox){var newbbox=_toConsumableArray(bbox);if(bbox[0]<maxbbox.west){newbbox[0]=maxbbox.west;}if(bbox[1]<maxbbox.south){newbbox[1]=maxbbox.south;}if(bbox[2]>maxbbox.east){newbbox[2]=maxbbox.east;}if(bbox[3]>maxbbox.north){newbbox[3]=maxbbox.north;}return newbbox;};// check point \nvar checkLoc=function checkLoc(loc){var newloc=_toConsumableArray(loc);if(loc[0]<maxbbox.west){newloc[0]=maxbbox.west;}if(loc[1]<maxbbox.south){newloc[1]=maxbbox.south;}if(loc[0]>maxbbox.east){newloc[0]=maxbbox.east;}if(loc[1]>maxbbox.north){newloc[1]=maxbbox.north;}return newloc;};var buildParams=function buildParams(input_params){var paramsToSubmit={grid:input_params.grid,output:input_params.output};//console.log(input_params) // for debugging\n// For \"interval\" date selection, calculate duration based on sdate and edate. \nvar mndiff=parseInt(input_params.edate.split(\"-\")[1])-parseInt(input_params.sdate.split(\"-\")[1]);var duration=mndiff+(mndiff>=0?1:13);// Set up nested elements\nvar origElem=input_params.elems[0];var newElems=[{elem:origElem,interval:[0,1],duration:duration,reduce:origElem.reduce}];// Replicate nested elems for all variables, if requested for a single grid point\nif(origElem.name==='all'){var nestedElem=_objectSpread(_objectSpread({},newElems[0].elem),{},{name:'maxt',reduce:elements[0].reduce});newElems[0]=_objectSpread(_objectSpread({},newElems[0]),{},{elem:nestedElem,reduce:elements[0].reduce});['mint','avgt','pcpn'].forEach(function(elem,i){nestedElem=_objectSpread(_objectSpread({},newElems[0].elem),{},{name:elem,reduce:elements[i+1].reduce});newElems.push(_objectSpread(_objectSpread({},newElems[0]),{},{elem:nestedElem,reduce:elements[i+1].reduce}));});}// Add actual elems as modified above to paramenters object\nparamsToSubmit.elems=newElems;// send just date instead of sdate and edate.\nvar newDate=input_params.elems[0].interval.length===2?input_params.edate.slice(0,7):input_params.edate;paramsToSubmit.date=newDate;// areaDef is type (state, loc, bbox) and value of area of interest.\nif(input_params.areaDef.bbox){input_params.areaDef.bbox=input_params.areaDef.bbox.map(function(x){return parseFloat(x);});var newbbox=checkBbox(input_params.areaDef.bbox);paramsToSubmit=_objectSpread(_objectSpread({},paramsToSubmit),{},{bbox:newbbox});//console.log(input_params.areaDef.bbox)\n}else if(input_params.areaDef.loc){input_params.areaDef.loc=input_params.areaDef.loc.map(function(x){return parseFloat(x);});var newloc=checkLoc(input_params.areaDef.loc);paramsToSubmit=_objectSpread(_objectSpread({},paramsToSubmit),{},{loc:newloc});}else if(input_params.areaDef.state){paramsToSubmit=_objectSpread(_objectSpread({},paramsToSubmit),input_params.areaDef);}else{console.log(\"unknown areaDef\");}// point location can only be json\nif(paramsToSubmit.loc){paramsToSubmit=_objectSpread(_objectSpread({},paramsToSubmit),{},{output:\"json\"});}// added image object if png output\nif(paramsToSubmit.output==='png'){var newImage=_objectSpread({},input_params.image);// convert levels string (from Image Settings) to array\nif(input_params.image.levels&&typeof input_params.image.levels==='string'){var splitLevels=input_params.image.levels.split(\",\");var newLevels=splitLevels.map(function(x){return parseFloat(x);});newImage=_objectSpread(_objectSpread({},newImage),{},{levels:newLevels});}// leave off empty levels element\nif(input_params.image.hasOwnProperty('levels')&&(input_params.image.levels===\"\"||input_params.image.levels.length===0)){delete newImage.levels;delete newImage.cmap;}if(input_params.image.hasOwnProperty('cmap')&&input_params.image.cmap.length===0){delete newImage.cmap;}paramsToSubmit=_objectSpread(_objectSpread({},paramsToSubmit),{},{image:newImage});}return paramsToSubmit;};// download a retrieved png image\nvar downloadFile=function downloadFile(href,filename){var link=document.createElement('a');link.href=href;link.download=filename;document.body.appendChild(link);link.click();document.body.removeChild(link);};// retrieve and download a geotiff or json file\nvar downloadFetch=function downloadFetch(jsonparams,filename,output){if(output==='json'){delete jsonparams.image;}var submitParams=JSON.stringify(_objectSpread(_objectSpread({},jsonparams),{},{output:output,meta:\"ll\"}));fetch(\"https://grid2.rcc-acis.org/GridData\",{body:submitParams,method:\"POST\",headers:{'Content-Type':'application/json'}}).then(function(response){if(!response.ok){console.log(\"Error fetching the results\");return;}return output==='json'?response.json():response.blob();}).then(function(response){var blob;if(output==='json'){var json=JSON.stringify(response);blob=new Blob([json],{type:'application/json'});}else{blob=response;}var href=window.URL.createObjectURL(blob);downloadFile(href,filename);}).catch(function(err){if(err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")){console.log(\"Invalid grid request - \"+jsonparams);}else{console.log(err.message);};});};export{buildParams,checkBbox,downloadFile,downloadFetch};","map":{"version":3,"sources":["/Users/kle1/progs/React/ncei-normals-mapper/src/utilities/utils.js"],"names":["elements","maxbbox","checkBbox","bbox","newbbox","west","south","east","north","checkLoc","loc","newloc","buildParams","input_params","paramsToSubmit","grid","output","mndiff","parseInt","edate","split","sdate","duration","origElem","elems","newElems","elem","interval","reduce","name","nestedElem","forEach","i","push","newDate","length","slice","date","areaDef","map","x","parseFloat","state","console","log","newImage","image","levels","splitLevels","newLevels","hasOwnProperty","cmap","downloadFile","href","filename","link","document","createElement","download","body","appendChild","click","removeChild","downloadFetch","jsonparams","submitParams","JSON","stringify","meta","fetch","method","headers","then","response","ok","json","blob","Blob","type","window","URL","createObjectURL","catch","err","message","includes"],"mappings":"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","sourcesContent":["import { elements, maxbbox } from '../utilities/constants';\n\n//const dateDiff = (date1, date2) => {\n//\tconst sdate = date1 instanceof Date ? date1 : new Date(date1);\n//\tconst edate = date2 instanceof Date ? date2 : new Date(date2);\n//\tconst one_day = 1000 * 60 * 60 * 24;\n//\treturn (Math.round((edate.getTime() - sdate.getTime()) / one_day));\n//};\n\n// check bounding box \nconst checkBbox = bbox => {\n\tconst newbbox = [...bbox]\n\tif (bbox[0] < maxbbox.west) {\n\t\tnewbbox[0] = maxbbox.west;\n\t}\n\tif (bbox[1] < maxbbox.south) {\n\t\tnewbbox[1] = maxbbox.south;\n\t}\n\tif (bbox[2] > maxbbox.east) {\n\t\tnewbbox[2] = maxbbox.east;\n\t}\n\tif (bbox[3] > maxbbox.north) {\n\t\tnewbbox[3] = maxbbox.north;\n\t}\n\treturn newbbox;\n};\n\n// check point \nconst checkLoc = loc => {\n\tconst newloc = [...loc]\n\tif (loc[0] < maxbbox.west) {\n\t\tnewloc[0] = maxbbox.west;\n\t}\n\tif (loc[1] < maxbbox.south) {\n\t\tnewloc[1] = maxbbox.south;\n\t}\n\tif (loc[0] > maxbbox.east) {\n\t\tnewloc[0] = maxbbox.east;\n\t}\n\tif (loc[1] > maxbbox.north) {\n\t\tnewloc[1] = maxbbox.north;\n\t}\n\treturn newloc;\n};\n\nconst buildParams = (input_params) => {\n\tlet paramsToSubmit = {grid: input_params.grid, output: input_params.output};\n\t//console.log(input_params) // for debugging\n\n\t// For \"interval\" date selection, calculate duration based on sdate and edate. \n\tconst mndiff = parseInt(input_params.edate.split(\"-\")[1]) - parseInt(input_params.sdate.split(\"-\")[1]);\n\tconst duration = mndiff + (mndiff >= 0 ? 1 : 13);\n\n\t// Set up nested elements\n\tconst origElem = input_params.elems[0];\n\tconst newElems = [\n\t\t{\n\t\t\telem: origElem, \n\t\t\tinterval: [0,1], \n\t\t\tduration: duration, \n\t\t\treduce: origElem.reduce\n\t\t}\n\t];\n\n\t// Replicate nested elems for all variables, if requested for a single grid point\n\tif (origElem.name === 'all') {\n\t\tlet nestedElem = {...newElems[0].elem, name: 'maxt', reduce: elements[0].reduce};\n\t\tnewElems[0] = {...newElems[0], elem:nestedElem, reduce: elements[0].reduce};\n\t\t['mint','avgt','pcpn'].forEach((elem,i) => {\n\t\t\tnestedElem = {...newElems[0].elem, name: elem, reduce: elements[i+1].reduce};\n\t\t\tnewElems.push({...newElems[0], elem: nestedElem, reduce: elements[i+1].reduce});\n\t\t});\n\t}\n\n\t// Add actual elems as modified above to paramenters object\n\tparamsToSubmit.elems = newElems;\n\n\t// send just date instead of sdate and edate.\n\tconst newDate = input_params.elems[0].interval.length === 2 ? input_params.edate.slice(0, 7) : input_params.edate;\n\tparamsToSubmit.date = newDate;\n\n\t// areaDef is type (state, loc, bbox) and value of area of interest.\n\tif (input_params.areaDef.bbox) {\n\t\tinput_params.areaDef.bbox = input_params.areaDef.bbox.map(x => parseFloat(x))\n\t\tconst newbbox = checkBbox(input_params.areaDef.bbox);\n\t\tparamsToSubmit = {...paramsToSubmit, bbox: newbbox};\n\t\t//console.log(input_params.areaDef.bbox)\n\t} else if (input_params.areaDef.loc) {\n\t\tinput_params.areaDef.loc = input_params.areaDef.loc.map(x => parseFloat(x))\n\t\tconst newloc = checkLoc(input_params.areaDef.loc);\n\t\tparamsToSubmit = {...paramsToSubmit, loc: newloc};\n\t} else if (input_params.areaDef.state) {\n\t\tparamsToSubmit = {...paramsToSubmit, ...input_params.areaDef};\n\t} else {\n\t\tconsole.log(\"unknown areaDef\");\n\t}\n\t\n\t// point location can only be json\n\tif (paramsToSubmit.loc) {\n\t\tparamsToSubmit = {...paramsToSubmit, output: \"json\"};\n\t}\n\n\t// added image object if png output\n\tif (paramsToSubmit.output === 'png') {\n\t\tlet newImage = {...input_params.image};\n\t\t// convert levels string (from Image Settings) to array\n\t\tif (input_params.image.levels && typeof input_params.image.levels === 'string') {\n\t\t\tconst splitLevels = input_params.image.levels.split(\",\");\n\t\t\tconst newLevels = splitLevels.map(x => parseFloat(x));\n\t\t\tnewImage = {...newImage, levels: newLevels};\n\t\t}\n\t\t// leave off empty levels element\n\t\tif (input_params.image.hasOwnProperty('levels') && (input_params.image.levels === \"\" || input_params.image.levels.length === 0)) {\n\t\t\tdelete newImage.levels;\n\t\t\tdelete newImage.cmap;\n\t\t}\n\t\tif (input_params.image.hasOwnProperty('cmap') && input_params.image.cmap.length === 0) {\n\t\t\tdelete newImage.cmap;\n\t\t}\n\n\t\tparamsToSubmit = {...paramsToSubmit, image: newImage};\n\t}\n\n\treturn paramsToSubmit;\t\n};\n\n// download a retrieved png image\nconst downloadFile = (href, filename) => {\n\tconst link = document.createElement('a');\n\tlink.href = href;\n\tlink.download = filename;\n\tdocument.body.appendChild(link);\n\tlink.click();\n\tdocument.body.removeChild(link);\n};\n\n// retrieve and download a geotiff or json file\nconst downloadFetch = (jsonparams, filename, output) => {\n\tif (output === 'json') {\n\t\tdelete jsonparams.image;\n\t}\n\tconst submitParams = JSON.stringify({...jsonparams, output:output, meta:\"ll\"});\n\tfetch(\"https://grid2.rcc-acis.org/GridData\", {body: submitParams, method: \"POST\", headers: {'Content-Type': 'application/json'}})\n\t\t.then(response => {\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.log(\"Error fetching the results\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn output === 'json' ? response.json() : response.blob();\n\t\t})\n\t\t.then(response => {\n\t\t\tvar blob;\n\t\t\tif (output === 'json') {\n\t\t\t\tconst json = JSON.stringify(response);\n  \t\t\t\tblob = new Blob([json], {type:'application/json'});\n\t\t\t} else {\n\t\t\t\tblob = response;\n\t\t\t}\n\t\t\tconst href = window.URL.createObjectURL(blob);\n\t\t\tdownloadFile(href, filename)\n\t\t})\n\t\t.catch(err => {\n\t\t\tif (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n\t\t\t\tconsole.log(\"Invalid grid request - \"+jsonparams);\n\t\t\t} else {\n\t\t\t\tconsole.log(err.message);\n\t\t\t};\n\t\t});\n};\n\nexport { buildParams, checkBbox, downloadFile, downloadFetch };"]},"metadata":{},"sourceType":"module"}