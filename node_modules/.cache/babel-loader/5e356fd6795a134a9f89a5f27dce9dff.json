{"ast":null,"code":"import _objectSpread from\"/Users/kle1/progs/React/ncei-normals-leaflet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread2\";import _toConsumableArray from\"/Users/kle1/progs/React/ncei-normals-leaflet/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";import{elements,maxbbox}from'../utilities/constants';//const dateDiff = (date1, date2) => {\n//\tconst sdate = date1 instanceof Date ? date1 : new Date(date1);\n//\tconst edate = date2 instanceof Date ? date2 : new Date(date2);\n//\tconst one_day = 1000 * 60 * 60 * 24;\n//\treturn (Math.round((edate.getTime() - sdate.getTime()) / one_day));\n//};\n// check bounding box \nvar checkBbox=function checkBbox(bbox){if(bbox[0]<maxbbox.west){bbox[0]=maxbbox.west;}if(bbox[1]<maxbbox.south){bbox[1]=maxbbox.south;}if(bbox[2]>maxbbox.east){bbox[2]=maxbbox.east;}if(bbox[3]>maxbbox.north){bbox[3]=maxbbox.north;}return bbox;};// check point \nvar checkLoc=function checkLoc(loc){loc[0]=parseFloat(loc[0]);loc[1]=parseFloat(loc[1]);if(loc[0]<maxbbox.west){loc[0]=maxbbox.west;}if(loc[1]<maxbbox.south){loc[1]=maxbbox.south;}if(loc[0]>maxbbox.east){loc[0]=maxbbox.east;}if(loc[1]>maxbbox.north){loc[1]=maxbbox.north;}return loc;};// find bounding box around one or more states\nvar multiStateBbox=function multiStateBbox(meta){var bbox={xn:0,xs:999,xw:0,xe:-999};meta.forEach(function(element){var _ref=_toConsumableArray(element.bbox),w=_ref[0],s=_ref[1],e=_ref[2],n=_ref[3];if(n>bbox.xn){bbox.xn=n;}if(s<bbox.xs){bbox.xs=s;}if(w<bbox.xw){bbox.xw=w;}if(e>bbox.xe){bbox.xe=e;}});var newbbox=[bbox.xw,bbox.xs,bbox.xe,bbox.xn];return checkBbox(newbbox);};/*\nconst fetchBbox = postals => {\n\tconst jsonparams = JSON.stringify({state: postals, meta: \"bbox\"});\n\tfetch(\"https://data.rcc-acis.org/General/state\", {body: jsonparams, method: \"POST\", headers: {'Content-Type': 'application/json'}})\n\t\t.then(response => {\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.log(\"Error fetching state bbox\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn response.json();\n\t\t})\n\t\t.then(response => {\n\t\t\tif (response.meta && response.meta.length) {\n\t\t\t\tlet bbox = multiStateBbox(response.meta);\n\t\t\t\tbbox = checkBbox(bbox);\n\t\t\t\tconsole.log(bbox)\n\t\t\t\treturn bbox;\n\t\t\t} else {\n\t\t\t\tconsole.log(\"No bbox for \" + postals);\n\t\t\t}\n\t\t})\n\t\t.catch(err => {\n\t\t\tif (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n\t\t\t\tconsole.log(\"Invalid request\");\n\t\t\t} else {\n\t\t\t\tconsole.log(err.message);\n\t\t\t};\n\t\t})\n};\n*/var buildParams=function buildParams(input_params){var paramsToSubmit={grid:input_params.grid,output:input_params.output};//console.log(input_params) // for debugging\n// For \"interval\" date selection, calculate duration based on sdate and edate. \nvar mndiff=parseInt(input_params.edate.split(\"-\")[1])-parseInt(input_params.sdate.split(\"-\")[1]);var duration=mndiff+(mndiff>=0?1:13);// Set up nested elements\nvar origElem=input_params.elems[0];var newElems=[{elem:origElem,interval:[0,1],duration:duration,reduce:origElem.reduce}];// Replicate nested elems for all variables\nif(origElem.name==='all'){var nestedElem=_objectSpread(_objectSpread({},newElems[0].elem),{},{name:'maxt',reduce:elements[0].reduce});newElems[0]=_objectSpread(_objectSpread({},newElems[0]),{},{elem:nestedElem,reduce:elements[0].reduce});['mint','avgt','pcpn'].forEach(function(elem,i){nestedElem=_objectSpread(_objectSpread({},newElems[0].elem),{},{name:elem,reduce:elements[i+1].reduce});newElems.push(_objectSpread(_objectSpread({},newElems[0]),{},{elem:nestedElem,reduce:elements[i+1].reduce}));});}// Add actual elems as modified above to paramenters object\nparamsToSubmit.elems=newElems;// send just date instead of sdate and edate.\nvar newDate=input_params.elems[0].interval.length===2?input_params.edate.slice(0,7):input_params.edate;paramsToSubmit.date=newDate;// areaDef is type (state, loc, bbox) and value of area of interest.\nif(input_params.areaDef.bbox){input_params.areaDef.bbox=checkBbox(input_params.areaDef.bbox);//console.log(input_params.areaDef.bbox)\n}else if(input_params.areaDef.loc){input_params.areaDef.loc=checkLoc(input_params.areaDef.loc);}else if(input_params.areaDef.state){//const postals = input_params.areaDef.state;\n//input_params.areaDef.bbox = fetchBbox(postals);\n//console.log(input_params.areaDef);\n}else{console.log(\"unknown areaDef\");}// Add areaDef\nparamsToSubmit=_objectSpread(_objectSpread({},paramsToSubmit),input_params.areaDef);// point location can only be json\nif(paramsToSubmit.loc){paramsToSubmit=_objectSpread(_objectSpread({},paramsToSubmit),{},{output:\"json\"});}return paramsToSubmit;};// download a retrieved gif image\nvar downloadFile=function downloadFile(href,filename){var link=document.createElement('a');link.href=href;link.download=filename;document.body.appendChild(link);link.click();document.body.removeChild(link);};// retrive and download a json file\nvar downloadFetch=function downloadFetch(stringparams,filename,output){var jsonparams=JSON.parse(stringparams);var submitParams=JSON.stringify(_objectSpread(_objectSpread({},jsonparams),{},{output:output,meta:\"ll\"}));fetch(\"https://grid2.rcc-acis.org/GridData\",{body:submitParams,method:\"POST\"}).then(function(response){if(!response.ok){console.log(\"Error fetching the results\");return;}return output==='json'?response.json():response.blob();}).then(function(response){var blob;if(output==='json'){var json=JSON.stringify(response);blob=new Blob([json],{type:'application/json'});}else{blob=response;}var href=window.URL.createObjectURL(blob);downloadFile(href,filename);}).catch(function(err){if(err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")){console.log(\"Invalid grid request - \"+jsonparams);}else{console.log(err.message);};});};export{buildParams,checkBbox,multiStateBbox,downloadFile,downloadFetch};","map":{"version":3,"sources":["/Users/kle1/progs/React/ncei-normals-leaflet/src/utilities/utils.js"],"names":["elements","maxbbox","checkBbox","bbox","west","south","east","north","checkLoc","loc","parseFloat","multiStateBbox","meta","xn","xs","xw","xe","forEach","element","w","s","e","n","newbbox","buildParams","input_params","paramsToSubmit","grid","output","mndiff","parseInt","edate","split","sdate","duration","origElem","elems","newElems","elem","interval","reduce","name","nestedElem","i","push","newDate","length","slice","date","areaDef","state","console","log","downloadFile","href","filename","link","document","createElement","download","body","appendChild","click","removeChild","downloadFetch","stringparams","jsonparams","JSON","parse","submitParams","stringify","fetch","method","then","response","ok","json","blob","Blob","type","window","URL","createObjectURL","catch","err","message","includes"],"mappings":"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","sourcesContent":["import { elements, maxbbox } from '../utilities/constants';\n\n//const dateDiff = (date1, date2) => {\n//\tconst sdate = date1 instanceof Date ? date1 : new Date(date1);\n//\tconst edate = date2 instanceof Date ? date2 : new Date(date2);\n//\tconst one_day = 1000 * 60 * 60 * 24;\n//\treturn (Math.round((edate.getTime() - sdate.getTime()) / one_day));\n//};\n\n// check bounding box \nconst checkBbox = bbox => {\n\tif (bbox[0] < maxbbox.west) {\n\t\tbbox[0] = maxbbox.west;\n\t}\n\tif (bbox[1] < maxbbox.south) {\n\t\tbbox[1] = maxbbox.south;\n\t}\n\tif (bbox[2] > maxbbox.east) {\n\t\tbbox[2] = maxbbox.east;\n\t}\n\tif (bbox[3] > maxbbox.north) {\n\t\tbbox[3] = maxbbox.north;\n\t}\n\treturn bbox;\n};\n\n// check point \nconst checkLoc = loc => {\n\tloc[0] = parseFloat(loc[0]);\n\tloc[1] = parseFloat(loc[1]);\n\tif (loc[0] < maxbbox.west) {\n\t\tloc[0] = maxbbox.west;\n\t}\n\tif (loc[1] < maxbbox.south) {\n\t\tloc[1] = maxbbox.south;\n\t}\n\tif (loc[0] > maxbbox.east) {\n\t\tloc[0] = maxbbox.east;\n\t}\n\tif (loc[1] > maxbbox.north) {\n\t\tloc[1] = maxbbox.north;\n\t}\n\treturn loc;\n};\n\n\n// find bounding box around one or more states\nconst multiStateBbox = meta => {\n\tvar bbox = {xn:0, xs:999, xw:0, xe:-999};\n\tmeta.forEach(element => {\n\t\tconst [w, s, e, n] = [...element.bbox];\n\t\tif (n > bbox.xn) { bbox.xn = n; }\n\t\tif (s < bbox.xs) { bbox.xs = s; }\n\t\tif (w < bbox.xw) { bbox.xw = w; }\n\t\tif (e > bbox.xe) { bbox.xe = e; }\n\t});\n\tconst newbbox = [bbox.xw,bbox.xs,bbox.xe,bbox.xn];\n\treturn checkBbox(newbbox);\n};\n\n/*\nconst fetchBbox = postals => {\n\tconst jsonparams = JSON.stringify({state: postals, meta: \"bbox\"});\n\tfetch(\"https://data.rcc-acis.org/General/state\", {body: jsonparams, method: \"POST\", headers: {'Content-Type': 'application/json'}})\n\t\t.then(response => {\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.log(\"Error fetching state bbox\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn response.json();\n\t\t})\n\t\t.then(response => {\n\t\t\tif (response.meta && response.meta.length) {\n\t\t\t\tlet bbox = multiStateBbox(response.meta);\n\t\t\t\tbbox = checkBbox(bbox);\n\t\t\t\tconsole.log(bbox)\n\t\t\t\treturn bbox;\n\t\t\t} else {\n\t\t\t\tconsole.log(\"No bbox for \" + postals);\n\t\t\t}\n\t\t})\n\t\t.catch(err => {\n\t\t\tif (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n\t\t\t\tconsole.log(\"Invalid request\");\n\t\t\t} else {\n\t\t\t\tconsole.log(err.message);\n\t\t\t};\n\t\t})\n};\n*/\n\nconst buildParams = (input_params) => {\n\tlet paramsToSubmit = {grid: input_params.grid, output: input_params.output};\n\t//console.log(input_params) // for debugging\n\n\t// For \"interval\" date selection, calculate duration based on sdate and edate. \n\tconst mndiff = parseInt(input_params.edate.split(\"-\")[1]) - parseInt(input_params.sdate.split(\"-\")[1]);\n\tconst duration = mndiff + (mndiff >= 0 ? 1 : 13);\n\n\t// Set up nested elements\n\tconst origElem = input_params.elems[0];\n\tconst newElems = [\n\t\t{\n\t\t\telem: origElem, \n\t\t\tinterval: [0,1], \n\t\t\tduration: duration, \n\t\t\treduce: origElem.reduce\n\t\t}\n\t];\n\n\t// Replicate nested elems for all variables\n\tif (origElem.name === 'all') {\n\t\tlet nestedElem = {...newElems[0].elem, name: 'maxt', reduce: elements[0].reduce};\n\t\tnewElems[0] = {...newElems[0], elem:nestedElem, reduce: elements[0].reduce};\n\t\t['mint','avgt','pcpn'].forEach((elem,i) => {\n\t\t\tnestedElem = {...newElems[0].elem, name: elem, reduce: elements[i+1].reduce};\n\t\t\tnewElems.push({...newElems[0], elem: nestedElem, reduce: elements[i+1].reduce});\n\t\t});\n\t}\n\n\t// Add actual elems as modified above to paramenters object\n\tparamsToSubmit.elems = newElems;\n\n\t// send just date instead of sdate and edate.\n\tconst newDate = input_params.elems[0].interval.length === 2 ? input_params.edate.slice(0, 7) : input_params.edate;\n\tparamsToSubmit.date = newDate;\n\n\t// areaDef is type (state, loc, bbox) and value of area of interest.\n\tif (input_params.areaDef.bbox) {\n\t\tinput_params.areaDef.bbox = checkBbox(input_params.areaDef.bbox);\n\t\t//console.log(input_params.areaDef.bbox)\n\t} else if (input_params.areaDef.loc) {\n\t\tinput_params.areaDef.loc = checkLoc(input_params.areaDef.loc);\n\t} else if (input_params.areaDef.state) {\n\t\t//const postals = input_params.areaDef.state;\n\t\t//input_params.areaDef.bbox = fetchBbox(postals);\n\t\t//console.log(input_params.areaDef);\n\t} else {\n\t\tconsole.log(\"unknown areaDef\");\n\t}\n\n\t// Add areaDef\n\tparamsToSubmit = {...paramsToSubmit, ...input_params.areaDef};\n\t\n\t// point location can only be json\n\tif (paramsToSubmit.loc) {\n\t\tparamsToSubmit = {...paramsToSubmit, output: \"json\"};\n\t}\n\n\treturn paramsToSubmit;\t\n};\n\n// download a retrieved gif image\nconst downloadFile = (href, filename) => {\n\tconst link = document.createElement('a');\n\tlink.href = href;\n\tlink.download = filename;\n\tdocument.body.appendChild(link);\n\tlink.click();\n\tdocument.body.removeChild(link);\n};\n\n// retrive and download a json file\nconst downloadFetch = (stringparams, filename, output) => {\n\tconst jsonparams = JSON.parse(stringparams);\n\tconst submitParams = JSON.stringify({...jsonparams, output:output, meta:\"ll\"});\n\tfetch(\"https://grid2.rcc-acis.org/GridData\", {body: submitParams, method: \"POST\"})\n\t\t.then(response => {\n\t\t\tif (!response.ok) {\n\t\t\t\tconsole.log(\"Error fetching the results\");\n\t\t\t\treturn;\n\t\t\t}\n\t\t\treturn output === 'json' ? response.json() : response.blob();\n\t\t})\n\t\t.then(response => {\n\t\t\tvar blob;\n\t\t\tif (output === 'json') {\n\t\t\t\tconst json = JSON.stringify(response);\n  \t\t\t\tblob = new Blob([json], {type:'application/json'});\n\t\t\t} else {\n\t\t\t\tblob = response;\n\t\t\t}\n\t\t\tconst href = window.URL.createObjectURL(blob);\n\t\t\tdownloadFile(href, filename)\n\t\t})\n\t\t.catch(err => {\n\t\t\tif (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n\t\t\t\tconsole.log(\"Invalid grid request - \"+jsonparams);\n\t\t\t} else {\n\t\t\t\tconsole.log(err.message);\n\t\t\t};\n\t\t});\n};\n\nexport { buildParams, checkBbox, multiStateBbox, downloadFile, downloadFetch };"]},"metadata":{},"sourceType":"module"}