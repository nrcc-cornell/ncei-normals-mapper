{"ast":null,"code":"import _objectSpread from\"/Users/keith/progs/React/ncei-normals-mapper/node_modules/@babel/runtime/helpers/esm/objectSpread2.js\";import _slicedToArray from\"/Users/keith/progs/React/ncei-normals-mapper/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState,useContext}from\"react\";import CircularProgress from\"@mui/material/CircularProgress\";import InputParamsContext from'./InputParamsContext';import{buildParams}from'../utilities/utils';import DisplayMap from\"./DisplayMap\";import DisplayJson from\"./DisplayJson\";import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var GetResults=function GetResults(){var _useState=useState(),_useState2=_slicedToArray(_useState,2),mapBlob=_useState2[0],setMapBlob=_useState2[1];var _useState3=useState(),_useState4=_slicedToArray(_useState3,2),jsonresp=_useState4[0],setJsonresp=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),imgInfo=_useState6[0],setImgInfo=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),resultsError=_useState8[0],setResultsError=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),loading=_useState10[0],setLoading=_useState10[1];var _useState11=useState(),_useState12=_slicedToArray(_useState11,2),submittedParams=_useState12[0],setSubmittedParams=_useState12[1];var inputContext=useContext(InputParamsContext);var fetchResponse=function fetchResponse(params,output){var infoInput=JSON.stringify(_objectSpread(_objectSpread({},params),{},{output:\"json\"}));fetch(\"https://grid2.rcc-acis.org/GridData\",{body:infoInput,method:\"POST\",headers:{'Content-Type':'application/json'}}).then(function(response){if(!response.ok){var message=\"Error on request\"+(response.statusText?\": \"+response.statusText:\"\");setResultsError(message);//return response.json();\t// return to possibly get better message from json\n}return response.json();}).then(function(response){if(response.error){setResultsError(response.status+\" \"+response.error);}else if(output==='png'){setResultsError(\"\");setMapBlob(response.data);setImgInfo(response);}else{setResultsError(\"\");setJsonresp(response.data);}}).catch(function(err){if(err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")){setResultsError(\"Invalid grid request - \"+infoInput);}else{setResultsError(\"Error: \"+err.message);};}).finally(function(x){setLoading(false);});};useEffect(function(){setResultsError(null);setLoading(true);// Build parameters\nvar input=buildParams(inputContext.inputParams);// Save parameters \nsetSubmittedParams(input);if(input.output==='png'&&input.image.levels){inputContext.updateLevels({client:input.image.levels});}else{inputContext.updateLevels({client:[]});}// Get results\nfetchResponse(input,input.output);// eslint-disable-next-line \n},[]);return/*#__PURE__*/_jsxs(_Fragment,{children:[loading&&/*#__PURE__*/_jsx(CircularProgress,{}),submittedParams&&(jsonresp||mapBlob)&&/*#__PURE__*/_jsxs(_Fragment,{children:[mapBlob&&/*#__PURE__*/_jsx(DisplayMap,{imgsrc:mapBlob,imgInfo:imgInfo,submittedParams:submittedParams}),jsonresp&&/*#__PURE__*/_jsx(DisplayJson,{jsonresp:jsonresp,submittedParams:submittedParams})]}),resultsError&&/*#__PURE__*/_jsx(\"p\",{children:resultsError})]});};export default GetResults;","map":{"version":3,"names":["React","useEffect","useState","useContext","CircularProgress","InputParamsContext","buildParams","DisplayMap","DisplayJson","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","GetResults","_useState","_useState2","_slicedToArray","mapBlob","setMapBlob","_useState3","_useState4","jsonresp","setJsonresp","_useState5","_useState6","imgInfo","setImgInfo","_useState7","_useState8","resultsError","setResultsError","_useState9","_useState10","loading","setLoading","_useState11","_useState12","submittedParams","setSubmittedParams","inputContext","fetchResponse","params","output","infoInput","JSON","stringify","_objectSpread","fetch","body","method","headers","then","response","ok","message","statusText","json","error","status","data","catch","err","includes","finally","x","input","inputParams","image","levels","updateLevels","client","children","imgsrc"],"sources":["/Users/keith/progs/React/ncei-normals-mapper/src/components/GetResults.js"],"sourcesContent":["import React, { useEffect, useState, useContext} from \"react\";\nimport CircularProgress from \"@mui/material/CircularProgress\";\nimport InputParamsContext from './InputParamsContext';\nimport { buildParams } from '../utilities/utils';\nimport DisplayMap from \"./DisplayMap\";\nimport DisplayJson from \"./DisplayJson\";\n\nconst GetResults = () => {\n\tconst [mapBlob, setMapBlob] = useState();\n\tconst [jsonresp, setJsonresp] = useState();\n\tconst [imgInfo, setImgInfo] = useState();\n\tconst [resultsError, setResultsError] = useState();\n\tconst [loading, setLoading] = useState(false);\n\tconst [submittedParams, setSubmittedParams] = useState();\n\tconst inputContext = useContext(InputParamsContext);\n\n\tconst fetchResponse = (params, output) => {\n\t\tconst infoInput = JSON.stringify({...params, output: \"json\"});\n\t\tfetch(\"https://grid2.rcc-acis.org/GridData\", {body: infoInput, method: \"POST\", headers: {'Content-Type': 'application/json'},})\n\t\t\t.then(response => {\n\t\t\t\tif (!response.ok) {\n\t\t\t\t\tconst message = \"Error on request\" + (response.statusText ? (\": \" + response.statusText) : \"\");\n\t\t\t\t\tsetResultsError(message);\n\t\t\t\t\t//return response.json();\t// return to possibly get better message from json\n\t\t\t\t}\n\t\t\t\treturn response.json();\n\t\t\t})\n\t\t\t.then(response => {\n\t\t\t\tif (response.error) {\n\t\t\t\t\tsetResultsError(response.status + \" \" + response.error)\n\t\t\t\t} else if (output === 'png') {\n\t\t\t\t\tsetResultsError(\"\");\n\t\t\t\t\tsetMapBlob(response.data);\n\t\t\t\t\tsetImgInfo(response);\n\t\t\t\t} else {\n\t\t\t\t\tsetResultsError(\"\");\n\t\t\t\t\tsetJsonresp(response.data);\n\t\t\t\t}\n\t\t\t})\n\t\t\t.catch(err => {\n\t\t\t\tif (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n\t\t\t\t\tsetResultsError(\"Invalid grid request - \"+infoInput);\n\t\t\t\t} else {\n\t\t\t\t\tsetResultsError(\"Error: \" + err.message);\n\t\t\t\t};\n\t\t\t})\n\t\t\t.finally((x) => {\n\t\t\t\tsetLoading(false);\n\t\t\t});\n\t};\n\n\tuseEffect(() => {\n\t\tsetResultsError(null);\n\t\tsetLoading(true);\n\t\t// Build parameters\n\t\tconst input = buildParams(inputContext.inputParams);\n\t\t// Save parameters \n\t\tsetSubmittedParams(input);\n\t\tif (input.output === 'png' && input.image.levels) {\n\t\t\tinputContext.updateLevels({client: input.image.levels});\n\t\t} else {\n\t\t\tinputContext.updateLevels({client: []});\n\t\t}\n\t\t// Get results\n\t\tfetchResponse(input, input.output);\n\t\t// eslint-disable-next-line \n\t}, []);\n\n\treturn (\n\t\t<>\n\t\t\t{loading &&\n\t\t\t\t<CircularProgress />\n\t\t\t}\n\t\t\t{submittedParams && (jsonresp || mapBlob) &&\n\t\t\t\t<>\n\t\t\t\t\t{mapBlob &&\n\t\t\t\t\t\t<DisplayMap \n\t\t\t\t\t\t\timgsrc={mapBlob}\n\t\t\t\t\t\t\timgInfo={imgInfo}\n\t\t\t\t\t\t\tsubmittedParams={submittedParams}\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t\t{jsonresp &&\n\t\t\t\t\t\t<DisplayJson\n\t\t\t\t\t\t\tjsonresp={jsonresp}\n\t\t\t\t\t\t\tsubmittedParams={submittedParams}\n\t\t\t\t\t\t/>\n\t\t\t\t\t}\n\t\t\t\t</>\n\t\t\t}\n\t\t\t{resultsError &&\n\t\t\t\t<p>{resultsError}</p>\n\t\t\t}\n\t\t</>\n\t);\n}\n\nexport default GetResults;"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}