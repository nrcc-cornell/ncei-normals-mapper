{"ast":null,"code":"import _slicedToArray from\"/Users/keith/progs/React/ncei-normals-mapper/node_modules/@babel/runtime/helpers/esm/slicedToArray.js\";import React,{useEffect,useState}from'react';import List from'@mui/material/List';import ListItem from'@mui/material/ListItem';import ListItemText from'@mui/material/ListItemText';import Menu from'@mui/material/Menu';import MenuItem from'@mui/material/MenuItem';import CircularProgress from\"@mui/material/CircularProgress\";import{makeStyles}from'@mui/styles';import{checkBbox}from'../utilities/utils';import{jsx as _jsx}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";var useStyles=makeStyles(function(theme){return{progressContainer:{margin:\"1.5em 3em\",textAlign:\"center\"},progressText:{margin:0,padding:\"6px\",color:\"rgba(0,0,0,0.54)\"},listContainer:{border:\"1pt solid lightgray\",padding:0},listItem:{padding:\"0 8px\",maxWidth:\"13em\"}};});var SubstateSelect=function SubstateSelect(props){var postals=props.postals,stateType=props.stateType,updateInputParams=props.updateInputParams;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),anchorEl=_useState2[0],setAnchorEl=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),selectedIndex=_useState4[0],setSelectedIndex=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),counties=_useState6[0],setCounties=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),fetchError=_useState8[0],setFetchError=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),loading=_useState10[0],setLoading=_useState10[1];var classes=useStyles();var fetchGeneral=function fetchGeneral(jsonparams){if(postals.length>=2){fetch(\"https://data.rcc-acis.org/General/\"+stateType,{body:jsonparams,method:\"POST\",headers:{'Content-Type':'application/json'}}).then(function(response){if(!response.ok){setFetchError(\"Error fetching the list\");return;}return response.json();}).then(function(response){if(response.meta&&response.meta.length){setCounties(response.meta);setSelectedIndex(0);var bbox=response.meta[0].bbox;bbox=checkBbox(bbox);updateInputParams({areaDef:{bbox:bbox}});}else{setFetchError(\"No list for \"+postals);}}).catch(function(err){if(err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")){setFetchError(\"Invalid request\");}else{setFetchError(err.message);};}).finally(function(){setLoading(false);});}else{setFetchError(\"Specify valid state above\");setLoading(false);}};var handleClickListItem=function handleClickListItem(event){setAnchorEl(event.currentTarget);};var handleMenuItemClick=function handleMenuItemClick(event,index){setSelectedIndex(index);setAnchorEl(null);var bbox=counties[index].bbox;bbox=checkBbox(bbox);updateInputParams({areaDef:{bbox:bbox}});};var handleClose=function handleClose(){setAnchorEl(null);};useEffect(function(){// Reset \nsetFetchError();setLoading(true);setCounties(null);// Get list\nvar jsonparams=JSON.stringify({state:postals,meta:\"name,id,bbox\"});fetchGeneral(jsonparams);// eslint-disable-next-line react-hooks/exhaustive-deps\n},[postals,stateType]);return/*#__PURE__*/_jsxs(_Fragment,{children:[counties&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(List,{className:classes.listContainer,\"aria-label\":stateType+\" selection\",children:/*#__PURE__*/_jsx(ListItem,{button:true,className:classes.listItem,\"aria-haspopup\":\"true\",\"aria-controls\":stateType+\"-menu\",\"aria-label\":\"selected \"+stateType,onClick:handleClickListItem,children:/*#__PURE__*/_jsx(ListItemText,{primary:\"Click to select \"+stateType,secondary:counties[selectedIndex]?\"Selected: \"+counties[selectedIndex].name.replace(/County|Parish/,\"\"):\"\"})})}),/*#__PURE__*/_jsx(Menu,{id:stateType+\"-menu\",anchorEl:anchorEl,keepMounted:true,open:Boolean(anchorEl),onClose:handleClose,children:counties.map(function(option,index){return/*#__PURE__*/_jsx(MenuItem,{selected:index===selectedIndex,onClick:function onClick(event){return handleMenuItemClick(event,index);},children:option.name.replace(/County|Parish/gi,\"\")},option.id);})})]}),loading&&/*#__PURE__*/_jsxs(\"div\",{className:classes.progressContainer,children:[/*#__PURE__*/_jsx(CircularProgress,{size:\"1em\"}),/*#__PURE__*/_jsx(\"p\",{className:classes.progressText,children:\"Loading\"})]}),fetchError&&/*#__PURE__*/_jsx(\"p\",{children:fetchError})]});};export default SubstateSelect;","map":{"version":3,"names":["React","useEffect","useState","List","ListItem","ListItemText","Menu","MenuItem","CircularProgress","makeStyles","checkBbox","jsx","_jsx","Fragment","_Fragment","jsxs","_jsxs","useStyles","theme","progressContainer","margin","textAlign","progressText","padding","color","listContainer","border","listItem","maxWidth","SubstateSelect","props","postals","stateType","updateInputParams","_useState","_useState2","_slicedToArray","anchorEl","setAnchorEl","_useState3","_useState4","selectedIndex","setSelectedIndex","_useState5","_useState6","counties","setCounties","_useState7","_useState8","fetchError","setFetchError","_useState9","_useState10","loading","setLoading","classes","fetchGeneral","jsonparams","length","fetch","body","method","headers","then","response","ok","json","meta","bbox","areaDef","catch","err","message","includes","finally","handleClickListItem","event","currentTarget","handleMenuItemClick","index","handleClose","JSON","stringify","state","children","className","button","onClick","primary","secondary","name","replace","id","keepMounted","open","Boolean","onClose","map","option","selected","size"],"sources":["/Users/keith/progs/React/ncei-normals-mapper/src/components/SubstateSelect.js"],"sourcesContent":["import React, { useEffect, useState } from 'react';\nimport List from '@mui/material/List';\nimport ListItem from '@mui/material/ListItem';\nimport ListItemText from '@mui/material/ListItemText';\nimport Menu from '@mui/material/Menu';\nimport MenuItem from '@mui/material/MenuItem';\nimport CircularProgress from \"@mui/material/CircularProgress\";\nimport { makeStyles } from '@mui/styles';\nimport { checkBbox } from '../utilities/utils';\n\nconst useStyles = makeStyles((theme) => ({\n\tprogressContainer: {\n        margin: \"1.5em 3em\",\n        textAlign: \"center\",\n    },\n    progressText: {\n        margin: 0,\n        padding: \"6px\",\n        color:  \"rgba(0,0,0,0.54)\",\n    },\n    listContainer: {\n\t\tborder: \"1pt solid lightgray\",\n        padding: 0,\n    },\n    listItem: {\n        padding: \"0 8px\",\n        maxWidth: \"13em\",\n    }\n}));\n\nconst SubstateSelect = (props) => {\n\tconst { postals, stateType, updateInputParams } = props;\n    const [anchorEl, setAnchorEl] = useState(null);\n    const [selectedIndex, setSelectedIndex] = useState(0);\n    const [counties, setCounties] = useState();\n    const [fetchError, setFetchError] = useState();\n\tconst [loading, setLoading] = useState(false);\n\n    const classes = useStyles();\n\n    const fetchGeneral = (jsonparams) => {\n        if (postals.length >= 2) {\n            fetch(\"https://data.rcc-acis.org/General/\"+stateType, {body: jsonparams, method: \"POST\", headers: {'Content-Type': 'application/json'}})\n                .then(response => {\n                    if (!response.ok) {\n                        setFetchError(\"Error fetching the list\");\n                        return;\n                    }\n                    return response.json()\n                })\n                .then(response => {\n                    if (response.meta && response.meta.length) {\n                        setCounties(response.meta);\n                        setSelectedIndex(0);\n                        let bbox = response.meta[0].bbox;\n                        bbox = checkBbox(bbox);\n                        updateInputParams({areaDef: {bbox: bbox}});\n                    } else {\n                        setFetchError(\"No list for \"+postals);\n                    }\n                })\n                .catch(err => {\n                    if (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n                        setFetchError(\"Invalid request\");\n                    } else {\n                        setFetchError(err.message);\n                    };\n                })\n                .finally(() => {\n                    setLoading(false);\n                });\n        } else {\n            setFetchError(\"Specify valid state above\");\n            setLoading(false);\n        }\n    };\n\n\tconst handleClickListItem = (event) => {\n\t\tsetAnchorEl(event.currentTarget);\n\t};\n\n\tconst handleMenuItemClick = (event, index) => {\n\t\tsetSelectedIndex(index);\n\t\tsetAnchorEl(null);\n        let bbox = counties[index].bbox;\n        bbox = checkBbox(bbox);\n\t\tupdateInputParams({areaDef: {bbox: bbox}});\n\t};\n\n\tconst handleClose = () => {\n\t\tsetAnchorEl(null);\n\t};\n\n    useEffect(() => {\n\t\t// Reset \n\t\tsetFetchError();\n\t\tsetLoading(true);\n        setCounties(null);\n        // Get list\n        const jsonparams = JSON.stringify({state: postals, meta: \"name,id,bbox\"});\n        fetchGeneral(jsonparams);\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ postals, stateType ]);\n\t\n\treturn (\n        <>\n            {counties &&\n                <>\n                <List className={classes.listContainer} aria-label={stateType+\" selection\"}>\n                    <ListItem\n                        button\n                        className={classes.listItem}\n                        aria-haspopup=\"true\"\n                        aria-controls={stateType+\"-menu\"}\n                        aria-label={\"selected \"+stateType}\n                        onClick={handleClickListItem}\n                    >\n                        <ListItemText \n                            primary={\"Click to select \"+stateType} \n                            secondary={counties[selectedIndex] ? \"Selected: \"+counties[selectedIndex].name.replace(/County|Parish/,\"\") : \"\"} \n                        />\n                    </ListItem>\n                </List>\n                <Menu\n                    id={stateType+\"-menu\"}\n                    anchorEl={anchorEl}\n                    keepMounted\n                    open={Boolean(anchorEl)}\n                    onClose={handleClose} \n                >\n                    {counties.map((option, index) => (\n                        <MenuItem\n                            key={option.id}\n                            selected={index === selectedIndex}\n                            onClick={(event) => handleMenuItemClick(event, index)}\n                            \n                        >\n                            {option.name.replace(/County|Parish/gi,\"\")}\n                        </MenuItem>\n                    ))}\n                </Menu>\n                </>\n            }\n            {loading &&\n                <div className={classes.progressContainer}>\n                    <CircularProgress size=\"1em\" />\n                    <p className={classes.progressText}>Loading</p>\n                </div>\n            }\n            {fetchError &&\n                <p>{fetchError}</p>\n            }\n        </>\n    )\n };\n\nexport default SubstateSelect;\n"],"mappings":"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"},"metadata":{},"sourceType":"module","externalDependencies":[]}