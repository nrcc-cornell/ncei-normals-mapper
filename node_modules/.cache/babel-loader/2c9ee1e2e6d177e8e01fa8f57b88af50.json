{"ast":null,"code":"import _slicedToArray from\"/Users/kle1/progs/React/normals-viewer/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import{jsx as _jsx}from\"react/jsx-runtime\";import{jsxs as _jsxs}from\"react/jsx-runtime\";import{Fragment as _Fragment}from\"react/jsx-runtime\";import React,{useEffect,useState,useContext}from'react';import List from'@material-ui/core/List';import ListItem from'@material-ui/core/ListItem';import ListItemText from'@material-ui/core/ListItemText';import Menu from'@material-ui/core/Menu';import MenuItem from'@material-ui/core/MenuItem';import CircularProgress from\"@material-ui/core/CircularProgress\";import InputParamsContext from'./InputParamsContext';import{makeStyles}from'@material-ui/core/styles';var useStyles=makeStyles(function(theme){return{progressContainer:{margin:\"1.5em 3em\",textAlign:\"center\"},progressText:{margin:0,padding:\"6px\",color:\"rgba(0,0,0,0.54)\"},listContainer:{border:\"1pt solid lightgray\"},listItem:{padding:\"0 8px\",maxWidth:\"13em\"}};});var SubstateSelect=function SubstateSelect(props){var postals=props.postals,stateType=props.stateType;var _useState=useState(null),_useState2=_slicedToArray(_useState,2),anchorEl=_useState2[0],setAnchorEl=_useState2[1];var _useState3=useState(0),_useState4=_slicedToArray(_useState3,2),selectedIndex=_useState4[0],setSelectedIndex=_useState4[1];var _useState5=useState(),_useState6=_slicedToArray(_useState5,2),counties=_useState6[0],setCounties=_useState6[1];var _useState7=useState(),_useState8=_slicedToArray(_useState7,2),fetchError=_useState8[0],setFetchError=_useState8[1];var _useState9=useState(false),_useState10=_slicedToArray(_useState9,2),loading=_useState10[0],setLoading=_useState10[1];var inputContext=useContext(InputParamsContext);var classes=useStyles();var fetchGeneral=function fetchGeneral(jsonparams){if(postals.length>=2){fetch(\"https://data.rcc-acis.org/General/\"+stateType,{body:jsonparams,method:\"POST\",headers:{'Content-Type':'application/json'}}).then(function(response){if(!response.ok){setFetchError(\"Error fetching the list\");return;}return response.json();}).then(function(response){if(response.meta&&response.meta.length){setCounties(response.meta);setSelectedIndex(0);inputContext.updateInputParams({areaDef:{bbox:response.meta[0].bbox}});}else{setFetchError(\"No list for \"+postals);}}).catch(function(err){if(err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")){setFetchError(\"Invalid request\");}else{setFetchError(err.message);};}).finally(function(){setLoading(false);});}else{setFetchError(\"Specify valid state above\");setLoading(false);}};var handleClickListItem=function handleClickListItem(event){setAnchorEl(event.currentTarget);};var handleMenuItemClick=function handleMenuItemClick(event,index){setSelectedIndex(index);setAnchorEl(null);inputContext.updateInputParams({areaDef:{bbox:counties[index].bbox}});};var handleClose=function handleClose(){setAnchorEl(null);};useEffect(function(){// Reset \nsetFetchError();setLoading(true);setCounties(null);// Get list\nvar jsonparams=JSON.stringify({state:postals,meta:\"name,id,bbox\"});fetchGeneral(jsonparams);// eslint-disable-next-line react-hooks/exhaustive-deps\n},[postals,stateType]);return/*#__PURE__*/_jsxs(_Fragment,{children:[counties&&/*#__PURE__*/_jsxs(_Fragment,{children:[/*#__PURE__*/_jsx(List,{className:classes.listContainer,\"aria-label\":stateType+\" selection\",children:/*#__PURE__*/_jsx(ListItem,{button:true,className:classes.listItem,\"aria-haspopup\":\"true\",\"aria-controls\":stateType+\"-menu\",\"aria-label\":\"selected \"+stateType,onClick:handleClickListItem,children:/*#__PURE__*/_jsx(ListItemText,{primary:\"Click to select \"+stateType,secondary:counties[selectedIndex]?\"Selected: \"+counties[selectedIndex].name.replace(/County|Parish/,\"\"):\"\"})})}),/*#__PURE__*/_jsx(Menu,{id:stateType+\"-menu\",anchorEl:anchorEl,keepMounted:true,open:Boolean(anchorEl),onClose:handleClose,children:counties.map(function(option,index){return/*#__PURE__*/_jsx(MenuItem,{selected:index===selectedIndex,onClick:function onClick(event){return handleMenuItemClick(event,index);},children:option.name.replace(/County|Parish/gi,\"\")},option.id);})})]}),loading&&/*#__PURE__*/_jsxs(\"div\",{className:classes.progressContainer,children:[/*#__PURE__*/_jsx(CircularProgress,{size:\"1em\"}),/*#__PURE__*/_jsx(\"p\",{className:classes.progressText,children:\"Loading\"})]}),fetchError&&/*#__PURE__*/_jsx(\"p\",{children:fetchError})]});};export default SubstateSelect;","map":{"version":3,"sources":["/Users/kle1/progs/React/normals-viewer/src/components/SubstateSelect.js"],"names":["React","useEffect","useState","useContext","List","ListItem","ListItemText","Menu","MenuItem","CircularProgress","InputParamsContext","makeStyles","useStyles","theme","progressContainer","margin","textAlign","progressText","padding","color","listContainer","border","listItem","maxWidth","SubstateSelect","props","postals","stateType","anchorEl","setAnchorEl","selectedIndex","setSelectedIndex","counties","setCounties","fetchError","setFetchError","loading","setLoading","inputContext","classes","fetchGeneral","jsonparams","length","fetch","body","method","headers","then","response","ok","json","meta","updateInputParams","areaDef","bbox","catch","err","message","includes","finally","handleClickListItem","event","currentTarget","handleMenuItemClick","index","handleClose","JSON","stringify","state","name","replace","Boolean","map","option","id"],"mappings":"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","sourcesContent":["import React, { useEffect, useState, useContext } from 'react';\nimport List from '@material-ui/core/List';\nimport ListItem from '@material-ui/core/ListItem';\nimport ListItemText from '@material-ui/core/ListItemText';\nimport Menu from '@material-ui/core/Menu';\nimport MenuItem from '@material-ui/core/MenuItem';\nimport CircularProgress from \"@material-ui/core/CircularProgress\";\nimport InputParamsContext from './InputParamsContext';\nimport { makeStyles } from '@material-ui/core/styles';\n\nconst useStyles = makeStyles((theme) => ({\n\tprogressContainer: {\n        margin: \"1.5em 3em\",\n        textAlign: \"center\",\n    },\n    progressText: {\n        margin: 0,\n        padding: \"6px\",\n        color:  \"rgba(0,0,0,0.54)\",\n    },\n    listContainer: {\n\t\tborder: \"1pt solid lightgray\",\n    },\n    listItem: {\n        padding: \"0 8px\",\n        maxWidth: \"13em\",\n    }\n}));\n\nconst SubstateSelect = (props) => {\n\tconst { postals, stateType } = props;\n    const [anchorEl, setAnchorEl] = useState(null);\n    const [selectedIndex, setSelectedIndex] = useState(0);\n    const [counties, setCounties] = useState();\n    const [fetchError, setFetchError] = useState();\n\tconst [loading, setLoading] = useState(false);\n    const inputContext = useContext(InputParamsContext);\n    const classes = useStyles();\n\n    const fetchGeneral = (jsonparams) => {\n        if (postals.length >= 2) {\n            fetch(\"https://data.rcc-acis.org/General/\"+stateType, {body: jsonparams, method: \"POST\", headers: {'Content-Type': 'application/json'}})\n                .then(response => {\n                    if (!response.ok) {\n                        setFetchError(\"Error fetching the list\");\n                        return;\n                    }\n                    return response.json()\n                })\n                .then(response => {\n                    if (response.meta && response.meta.length) {\n                        setCounties(response.meta);\n                        setSelectedIndex(0);\n                        inputContext.updateInputParams({areaDef: {bbox: response.meta[0].bbox}});\n                    } else {\n                        setFetchError(\"No list for \"+postals);\n                    }\n                })\n                .catch(err => {\n                    if (err.message.includes(\"Failed to execute 'createObjectURL' on 'URL'\")) {\n                        setFetchError(\"Invalid request\");\n                    } else {\n                        setFetchError(err.message);\n                    };\n                })\n                .finally(() => {\n                    setLoading(false);\n                });\n        } else {\n            setFetchError(\"Specify valid state above\");\n            setLoading(false);\n        }\n    };\n\n\tconst handleClickListItem = (event) => {\n\t\tsetAnchorEl(event.currentTarget);\n\t};\n\n\tconst handleMenuItemClick = (event, index) => {\n\t\tsetSelectedIndex(index);\n\t\tsetAnchorEl(null);\n\t\tinputContext.updateInputParams({areaDef: {bbox: counties[index].bbox}});\n\t};\n\n\tconst handleClose = () => {\n\t\tsetAnchorEl(null);\n\t};\n\n    useEffect(() => {\n\t\t// Reset \n\t\tsetFetchError();\n\t\tsetLoading(true);\n        setCounties(null);\n        // Get list\n        const jsonparams = JSON.stringify({state: postals, meta: \"name,id,bbox\"});\n        fetchGeneral(jsonparams);\n\t\t// eslint-disable-next-line react-hooks/exhaustive-deps\n\t}, [ postals, stateType ]);\n\t\n\treturn (\n        <>\n        {counties &&\n            <>\n            <List className={classes.listContainer} aria-label={stateType+\" selection\"}>\n                <ListItem\n                    button\n                    className={classes.listItem}\n                    aria-haspopup=\"true\"\n                    aria-controls={stateType+\"-menu\"}\n                    aria-label={\"selected \"+stateType}\n                    onClick={handleClickListItem}\n                >\n                    <ListItemText \n                        primary={\"Click to select \"+stateType} \n                        secondary={counties[selectedIndex] ? \"Selected: \"+counties[selectedIndex].name.replace(/County|Parish/,\"\") : \"\"} \n                    />\n                </ListItem>\n            </List>\n            <Menu\n                id={stateType+\"-menu\"}\n                anchorEl={anchorEl}\n                keepMounted\n                open={Boolean(anchorEl)}\n                onClose={handleClose} \n            >\n                {counties.map((option, index) => (\n                    <MenuItem\n                        key={option.id}\n                        selected={index === selectedIndex}\n                        onClick={(event) => handleMenuItemClick(event, index)}\n                        \n                    >\n                        {option.name.replace(/County|Parish/gi,\"\")}\n                    </MenuItem>\n                ))}\n            </Menu>\n            </>\n        }\n        {loading &&\n            <div className={classes.progressContainer}>\n                <CircularProgress size=\"1em\" />\n                <p className={classes.progressText}>Loading</p>\n            </div>\n        }\n        {fetchError &&\n            <p>{fetchError}</p>\n        }\n        </>\n\t);\n };\n\nexport default SubstateSelect;\n"]},"metadata":{},"sourceType":"module"}